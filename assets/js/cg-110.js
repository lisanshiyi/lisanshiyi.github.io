(window.webpackJsonp=window.webpackJsonp||[]).push([[110],{402:function(s,a,t){"use strict";t.r(a);var e=t(7),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("大家好，我是"),a("code",[s._v("三十一")]),a("sup",[s._v("[0]")]),s._v("，本次分享分布式神器"),a("code",[s._v("etcd")]),a("sup",[s._v("[1]")]),s._v("的 5 种部署方式和 10 种使用姿势，阅读全文预计花费 16 分钟。如果对你有帮助，也欢迎号友们点赞收藏。")]),s._v(" "),a("p",[s._v("在学习 etcd 之前，我们先来聊一聊 "),a("code",[s._v("etcd 名字的由来")]),a("sup",[s._v("[2]")]),s._v("。etcd 中的 etc 取自 unix 系统的"),a("code",[s._v("/etc")]),s._v("目录，再加上一个"),a("code",[s._v("d")]),s._v("代表"),a("code",[s._v("distributed system")]),s._v("就组成了 etcd。在 unix 系统中 /etc 目录用于存储系统的配置数据，单从名字看 etcd 可用于存储分布式系统的配置数据，有时候也把 etcd 简单理解为分布式 /etc 配置目录。")]),s._v(" "),a("h2",{attrs:{id:"etcd-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#etcd-简介"}},[s._v("#")]),s._v(" etcd 简介")]),s._v(" "),a("p",[s._v("etcd 是一个可靠的分布式 key-value 存储系统，主要用于"),a("code",[s._v("配置共享")]),s._v("和"),a("code",[s._v("服务注册和发现")]),s._v("，具有以下特性：")]),s._v(" "),a("ul",[a("li",[s._v("简单：基于 gRPC 定义了清晰、面向用户的 API。")]),s._v(" "),a("li",[s._v("安全：支持可选的客户端 TLS 证书自动认证特性。")]),s._v(" "),a("li",[s._v("快速：支持每秒 10000 次的写入。")]),s._v(" "),a("li",[s._v("可靠：基于 Raft 算法协议保证一致性。")])]),s._v(" "),a("p",[s._v("etcd 使用 Go 语言开发，底层基于 Raft 共识算法管理高可用的复制日志。当前已经被许多公司用于关键生产项目，比如：Kubernetes、locksmith、vulcand、Doorman 等。")]),s._v(" "),a("p",[s._v("当然，也有其他组件可以提供配置共享和服务注册和发现的功能，比如最为广泛和大家最为熟知的 Zookeeper，也被很多 Java 系的知名开源项目认可和使用，比如：Hadoop、HBase、Kafka 等。")]),s._v(" "),a("p",[s._v("但 etcd 是唯一一个可以媲美甚至超越 Zookeeper 的组件。")]),s._v(" "),a("p",[s._v("相较之下，Zookeeper 有如下缺点[3]：")]),s._v(" "),a("ul",[a("li",[s._v("复杂：Zookeeper 基于 ZAB 协议，属于类 Paxos 协议，而 Paxos 算法素以复杂难懂闻名；Zookeeper 的使用也比较复杂，需要安装客户端，而官方目前只提供了 Java 和 C 两种语言接口。")]),s._v(" "),a("li",[s._v("发展慢：由于基金会庞大的结构以及松散的管理，导致项目发展缓慢。")])]),s._v(" "),a("p",[s._v("而 etcd 作为后起之秀，其优点也很明显：")]),s._v(" "),a("ul",[a("li",[s._v("简单：使用 Go 语言编写部署简单；使用 gRPC 定义接口，支持跨语言、跨平台特性；使用了易于用户理解的 Raft 算法保证一致性，优于 Paxos 算法。")]),s._v(" "),a("li",[s._v("发展快：etcd 正处于高速迭代开发中。")]),s._v(" "),a("li",[s._v("性能优越：官方提供的基准测试数据中，etcd 集群可以支持每秒 10000+ 次的写入，性能优于 Zookeeper。")]),s._v(" "),a("li",[s._v("安全性：etcd 支持 TLS 访问，而 ZooKeeper 在权限控制方面做得略显粗糙。")])]),s._v(" "),a("h2",{attrs:{id:"环境搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境搭建"}},[s._v("#")]),s._v(" 环境搭建")]),s._v(" "),a("h3",{attrs:{id:"一、本地安装包部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、本地安装包部署"}},[s._v("#")]),s._v(" 一、本地安装包部署")]),s._v(" "),a("p",[a("strong",[s._v("下载")]),s._v("：下载最新的安装包（当前最新：v3.5.4），下载地址：https://github.com/etcd-io/etcd/releases/")]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://lisanshiyi.com/assets/network/grpc/grpc-02.png",loading:"lazy"}})]),s._v(" "),a("p",[a("strong",[s._v("安装")]),s._v("：在解压后的文件目录下"),a("code",[s._v("etcd")]),s._v("、"),a("code",[s._v("etcdctl")]),s._v("分别为安装包和客户端的编译后的执行文件，可使用三种方法进行运行配置。")]),s._v(" "),a("ul",[a("li",[s._v("方法一：解压目录下直接运行")]),s._v(" "),a("li",[s._v("方法二：把"),a("code",[s._v("etcd")]),s._v("、"),a("code",[s._v("etcdctl")]),s._v("文件复制到"),a("code",[s._v("GOBIN")]),s._v("目录下。")]),s._v(" "),a("li",[s._v("方法三：在环境变量里添加"),a("code",[s._v("etcd")]),s._v("、"),a("code",[s._v("etcdctl")]),s._v("文件所在的目录。")])]),s._v(" "),a("p",[s._v("注：运行过程中，可能会涉及权限问题，授权即可。")]),s._v(" "),a("p",[a("strong",[s._v("验证")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证 etcd 版本")]),s._v("\n$ etcd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v("\n\netcd Version: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.5")]),s._v(".4\nGit SHA: 08407ff76\nGo Version: go1.16.15\nGo OS/Arch: darwin/amd64\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证 etcdctl 版本")]),s._v("\n$ etcdctl version\n\netcdctl version: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.5")]),s._v(".4\nAPI version: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.5")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h3",{attrs:{id:"二、本地编译部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、本地编译部署"}},[s._v("#")]),s._v(" 二、本地编译部署")]),s._v(" "),a("p",[a("strong",[s._v("下载")]),s._v("：使用以下命令克隆代码")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载最新版")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/etcd-io/etcd.git\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定版本下载")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-b")]),s._v(" v3.5.4 https://github.com/etcd-io/etcd.git\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("strong",[s._v("编译安装")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编译")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" etcd\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" build\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v('/bin"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("strong",[s._v("验证")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证 etcd 版本")]),s._v("\n$ etcd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证 etcdctl 版本")]),s._v("\n$ etcdctl version\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证 etcdutl 版本")]),s._v("\n$ etcdutl version\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"三、本地集群部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、本地集群部署"}},[s._v("#")]),s._v(" 三、本地集群部署")]),s._v(" "),a("p",[s._v("首先需要安装"),a("code",[s._v("goreman")]),s._v("组件，它基于 Procfile 配置文件管理 etcd 应用进程。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ go "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" github.com/mattn/goreman@latest\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("启动集群")]),s._v("：源码目录下"),a("code",[s._v("Procfile")]),s._v("脚本已经构建好了本地演示集群，直接运行启动即可")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ goreman start\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("验证")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ etcdctl member list\n\n8211f1d0f64f3269, started, infra1, http://127.0.0.1:12380, http://127.0.0.1:2379, "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n91bc3c398fb3c146, started, infra2, http://127.0.0.1:22380, http://127.0.0.1:22379, "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\nfd422379fda50e48, started, infra3, http://127.0.0.1:32380, http://127.0.0.1:32379, "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("该脚本创建包含 3 个 etcd 成员节点的集群，每个集群成员都接收键值的读取和写入。也可以按照"),a("code",[s._v("Procfile.learner")]),s._v("脚本指导，学习集群新增节点的操作。")]),s._v(" "),a("h3",{attrs:{id:"四、docker-单机部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、docker-单机部署"}},[s._v("#")]),s._v(" 四、Docker 单机部署")]),s._v(" "),a("p",[s._v("此处通过"),a("code",[s._v("docker-compose")]),s._v("进行实验配置。")]),s._v(" "),a("p",[a("strong",[s._v("镜像拉取")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull bitnami/etcd:3.5.2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("编辑docker-compose.yml")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("version: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.5'")]),s._v("\n\nservices:\n  etcd:\n    container_name: builder-etcd\n    image: bitnami/etcd:3.5.2\n    ports:\n      - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),s._v(":2379\n    environment:\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALLOW_NONE_AUTHENTICATION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_AUTO_COMPACTION_MODE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("revision\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_AUTO_COMPACTION_RETENTION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1002")]),s._v("\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_QUOTA_BACKEND_BYTES")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4294967296")]),s._v("\n    volumes:\n      - "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DOCKER_ROOT_DIR"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":-")]),s._v(".}")]),s._v("/volumes/etcd/data:/bitnami/etcd\n\nnetworks:\n  default:\n    name: builder_dev\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[a("strong",[s._v("启动服务")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" docker-compose.yml up\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("验证")]),s._v("：验证集群节点的版本")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" builder-etcd /bin/bash "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd --version"')]),s._v("\n\netcd Version: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.5")]),s._v(".2\nGit SHA: 99018a77b\nGo Version: go1.16.3\nGo OS/Arch: linux/amd64\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"五、docker-集群部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、docker-集群部署"}},[s._v("#")]),s._v(" 五、Docker 集群部署")]),s._v(" "),a("p",[a("strong",[s._v("编辑docker-compose.yml")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("version: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.5'")]),s._v("\n\nservices:\n  etcd1:\n    container_name: builder-etcd1\n    image: bitnami/etcd:3.5.2\n    ports:\n      - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12379")]),s._v(":2379\n    environment:\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALLOW_NONE_AUTHENTICATION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_AUTO_COMPACTION_MODE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("revision\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_AUTO_COMPACTION_RETENTION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1002")]),s._v("\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_QUOTA_BACKEND_BYTES")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4294967296")]),s._v("\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("etcd1\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_ADVERTISE_PEER_URLS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd1:2380\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_LISTEN_PEER_URLS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://0.0.0.0:2380\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_LISTEN_CLIENT_URLS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://0.0.0.0:2379\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_ADVERTISE_CLIENT_URLS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd1:2379\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER_TOKEN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("etcd-cluster\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("etcd1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd1:2380,etcd2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd2:2380,etcd3"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd3:2380\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER_STATE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("new\n    volumes:\n      - "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DOCKER_ROOT_DIR"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":-")]),s._v(".}")]),s._v("/volumes/etcd/data1:/bitnami/etcd\n\n  etcd2:\n    container_name: builder-etcd2\n    image: bitnami/etcd:3.5.2\n    ports:\n      - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22379")]),s._v(":2379\n    environment:\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALLOW_NONE_AUTHENTICATION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_AUTO_COMPACTION_MODE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("revision\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_AUTO_COMPACTION_RETENTION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1002")]),s._v("\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_QUOTA_BACKEND_BYTES")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4294967296")]),s._v("\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("etcd2\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_ADVERTISE_PEER_URLS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd2:2380\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_LISTEN_PEER_URLS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://0.0.0.0:2380\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_LISTEN_CLIENT_URLS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://0.0.0.0:2379\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_ADVERTISE_CLIENT_URLS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd2:2379\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER_TOKEN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("etcd-cluster\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("etcd1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd1:2380,etcd2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd2:2380,etcd3"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd3:2380\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER_STATE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("new\n    volumes:\n      - "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DOCKER_ROOT_DIR"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":-")]),s._v(".}")]),s._v("/volumes/etcd/data2:/bitnami/etcd\n\n  etcd3:\n    container_name: builder-etcd3\n    image: bitnami/etcd:3.5.2\n    ports:\n      - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32379")]),s._v(":2379\n    environment:\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALLOW_NONE_AUTHENTICATION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_AUTO_COMPACTION_MODE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("revision\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_AUTO_COMPACTION_RETENTION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1002")]),s._v("\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_QUOTA_BACKEND_BYTES")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4294967296")]),s._v("\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("etcd3\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_ADVERTISE_PEER_URLS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd3:2380\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_LISTEN_PEER_URLS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://0.0.0.0:2380\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_LISTEN_CLIENT_URLS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://0.0.0.0:2379\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_ADVERTISE_CLIENT_URLS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd3:2379\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER_TOKEN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("etcd-cluster\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("etcd1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd1:2380,etcd2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd2:2380,etcd3"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd3:2380\n      - "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER_STATE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("new\n    volumes:\n      - "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DOCKER_ROOT_DIR"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":-")]),s._v(".}")]),s._v("/volumes/etcd/data3:/bitnami/etcd\n\nnetworks:\n  default:\n    name: builder_dev\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br")])]),a("p",[s._v("部署配置文件 docker-compose.yml 细节，详见"),a("code",[s._v("etcd docker-compose yml")]),a("sup",[s._v("[4]")])]),s._v(" "),a("p",[a("strong",[s._v("启动服务")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" docker-compose.yml up\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("验证")]),s._v("：验证集群节点的版本")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" builder-etcd1 /bin/bash "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd --version"')]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" builder-etcd2 /bin/bash "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd --version"')]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" builder-etcd3 /bin/bash "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd --version"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出")]),s._v("\netcd Version: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.5")]),s._v(".2\nGit SHA: 99018a77b\nGo Version: go1.16.3\nGo OS/Arch: linux/amd64\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h2",{attrs:{id:"api-学习"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api-学习"}},[s._v("#")]),s._v(" API 学习")]),s._v(" "),a("p",[s._v("此处，通过使用"),a("code",[s._v("etcdctl")]),a("sup",[s._v("[5]")]),s._v("进行 API 学习验证，etcdctl 是一个用于与 etcd 服务器交互的命令行工具。")]),s._v(" "),a("p",[a("strong",[s._v("1.查看版本")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ etcdctl version\n\netcdctl version: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.6")]),s._v(".0-alpha.0\nAPI version: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.6")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("strong",[s._v("2.写入 key")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ etcdctl put foo bar\nOK\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("strong",[s._v("3.读取 key")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ etcdctl get foo\nfoo\nbar\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只是获取值")]),s._v("\n$ etcdctl get foo --print-value-only\nbar\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("strong",[s._v("4.批量取值")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ etcdctl put foo1 bar1\n$ etcdctl put foo3 bar2\n$ etcdctl put foo3 bar3\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取从 foo 到 foo3 的值，不包括 foo3")]),s._v("\n$ etcdctl get foo foo3 --print-value-only \nbar\nbar1\nbar2\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取前缀为 foo 的值")]),s._v("\n$ etcdctl get "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--prefix")]),s._v(" foo --print-value-only\nbar\nbar1\nbar2\nbar3\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取符合前缀的前两个值")]),s._v("\n$ etcdctl get "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--prefix")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--limit")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" foo --print-value-only\nbar\nbar1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[a("strong",[s._v("5.删除 key")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除 foo 的值")]),s._v("\n$ etcdctl del foo\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除 foo 到 foo2 且不包括 foo2 的值")]),s._v("\n$ etcdctl del foo foo2\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除前缀为 foo 的所有值")]),s._v("\n$ etcdctl del "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--prefix")]),s._v(" foo\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[a("strong",[s._v("6.监听")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监听 foo 单个 key")]),s._v("\n$ etcdctl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" foo\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 另一个控制台执行： etcdctl put foo bar")]),s._v("\nPUT\nfoo\nbar\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同时监视多个值")]),s._v("\n$ etcdctl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" foo\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" zoo\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 另一个控制台执行: etcdctl put foo bar")]),s._v("\nPUT\nfoo\nbar\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 另一个控制台执行: etcdctl put zoo val")]),s._v("\nPUT\nzoo\nval\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 监视 foo 前缀命中的 key")]),s._v("\n$ etcdctl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--prefix")]),s._v(" foo\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 另一个控制台执行： etcdctl put foo1 bar1")]),s._v("\nPUT\nfoo1\nbar1\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 另一个控制台执行： etcdctl put fooz1 barz1")]),s._v("\nPUT\nfooz1\nbarz1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("p",[a("strong",[s._v("7.设置租约")]),s._v("\n当一个 key 被绑定到一个租约上时，它的生命周期与租约的生命周期即绑定。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置10秒后过期时间")]),s._v("\n$ etcdctl lease grant "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\nlease 32698142c52a170a granted with TTL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("10s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把 foo 和租约绑定，设置成 10 秒后过期")]),s._v("\n$ etcdctl put "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--lease")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("32698142c52a170a foo bar\nOK\n$ etcdctl get foo\nfoo\nbar\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 10 秒后，获取不到 foo")]),s._v("\n$ etcdctl get foo\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回空")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[a("strong",[s._v("8.撤销租约")]),s._v("\n通过租约 ID 撤销租约，撤销租约将删除其所有绑定的 key。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ etcdctl lease grant "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\nlease 32698142c52a170c granted with TTL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("10s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n$ etcdctl put "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--lease")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("32698142c52a170c foo bar\nOK\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 撤销租约")]),s._v("\n$ etcdctl lease revoke 32698142c52a170c\nlease 32698142c52a170c revoked\n\n$ etcdctl get foo\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回空")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[a("strong",[s._v("9.续约")]),s._v("\n通过刷新 TTL 值来保持租约的有效，使其不会过期。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置 10 秒后过期租约")]),s._v("\n$ etcdctl lease grant "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\nlease 32698142c52a170f granted with TTL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("10s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 把 foo 和租约绑定，设置成 10 秒后过期")]),s._v("\n$ etcdctl put foo bar "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--lease")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("32698142c52a170f\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自动定时执行续约，续约成功后每次租约为 10 秒")]),s._v("\n$ etcdctl lease keep-alive 32698142c52a170f\nlease 32695410dcc0ca06 keepalived with TTL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nlease 32695410dcc0ca06 keepalived with TTL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nlease 32695410dcc0ca06 keepalived with TTL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[a("strong",[s._v("10.查看租约")]),s._v("\n查看租约信息，以便续租或查看租约是否仍然存在或已过期")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置 50 秒 TTL")]),s._v("\n$ etcdctl lease grant "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\nlease 32698142c52a1711 granted with TTL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("50s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# zoo1 绑定 32698142c52a1711 租约")]),s._v("\n$ etcdctl put "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--lease")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("32698142c52a1711 zoo1 val1\nOK\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看租约，remaining(32s) 剩余有效时间32秒；--keys 获取租约绑定的 key")]),s._v("\n$ etcdctl lease timetolive "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--keys")]),s._v(" 32698142c52a1711\nlease 32698142c52a1711 granted with TTL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("50s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", remaining"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("32s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", attached keys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("zoo1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("注：一个租约支持绑定多个 key")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ etcdctl lease grant "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\nlease 32698142c52a1713 granted with TTL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("50s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n$ etcdctl put "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--lease")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("32698142c52a1713 zoo1 val1\nOK\n\n$ etcdctl put "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--lease")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("32698142c52a1713 zoo2 val2\nOK\n\n$ etcdctl put "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--lease")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("32698142c52a1713 zoo3 val3\nOK\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("租约过期后，所有 key 值都会被删除，因此：")]),s._v(" "),a("ul",[a("li",[s._v("当租约只绑定了一个 key 时，想删除这个 key，最好的办法是撤销它的租约，而不是直接删除这个 key。")]),s._v(" "),a("li",[s._v("当租约没有绑定key时，应主动把它撤销掉，单纯删除 key 后，续约操作持续进行，会造成内存泄露。")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 方法一：直接删除`key`")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置租约并绑定 zoo1")]),s._v("\n$ etcdctl lease grant "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\nlease 32698142c52a1715 granted with TTL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("50s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n$ etcdctl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--lease")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("32698142c52a1715 put zoo1 val1\nOK\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 续约")]),s._v("\n$ etcdctl lease keep-alive 32698142c52a1715\nlease 32698142c52a1715 keepalived with TTL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 另一个控制台执行：etcdctl del zoo1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 单纯删除 key 后，续约操作持续进行，会造成内存泄露")]),s._v("\nlease 32698142c52a1715 keepalived with TTL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nlease 32698142c52a1715 keepalived with TTL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nlease 32698142c52a1715 keepalived with TTL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 方法二：撤销`key`的租约")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置租约并绑定 zoo1")]),s._v("\n$ etcdctl lease grant "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\nlease 32698142c52a1717 granted with TTL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("50s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n$ etcdctl "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--lease")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("32698142c52a1717 put zoo1 val1\nOK\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 续约")]),s._v("\n$ etcdctl lease keep-alive 32698142c52a1717\nlease 32698142c52a1717 keepalived with TTL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nlease 32698142c52a1717 keepalived with TTL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 另一个控制台执行：etcdctl lease revoke 32698142c52a1717")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 续约撤销并退出")]),s._v("\nlease 32698142c52a1717 expired or revoked.\n$ etcdctl get zoo1\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回空")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br")])]),a("p",[s._v("以上，就是今天的全部内容，几乎包含了 etcd 安装和使用的各种姿势，欢迎各位号友敬请尝试。")]),s._v(" "),a("h2",{attrs:{id:"references"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[s._v("#")]),s._v(" References")]),s._v(" "),a("ul",[a("li",[s._v("[0] 三十一: https://www.lisanshiyi.com/assets/image/ThirtyOneLee.jpeg")]),s._v(" "),a("li",[s._v("[1] etcd: https://github.com/etcd-io/etcd")]),s._v(" "),a("li",[s._v("[2] etcd 名字的由来: https://etcd.io/docs/v3.5/faq/")]),s._v(" "),a("li",[s._v("[3] https://www.infoq.cn/article/etcd-interpretation-application-scenario-implement-principle/")]),s._v(" "),a("li",[s._v("[4] etcd docker-compose yml: https://github.com/liyaodev/docker-compose")]),s._v(" "),a("li",[s._v("[5] etcdctl: https://etcd.io/docs/v3.5/dev-guide/interacting_v3/")])])])}),[],!1,null,null,null);a.default=n.exports}}]);