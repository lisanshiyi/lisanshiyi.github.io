(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{364:function(e,s,a){"use strict";a.r(s);var t=a(7),n=Object(t.a)({},(function(){var e=this,s=e._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"问题描述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题描述"}},[e._v("#")]),e._v(" 问题描述")]),e._v(" "),s("p",[e._v("服务通过"),s("code",[e._v("Flask + Gunicorn + Gevent")]),e._v("，升级Python版本至3.7以后，运行报错，具体报错如下：")]),e._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("/usr/local/lib/python3.7/importlib/_bootstrap.py:219: RuntimeWarning: greenlet.greenlet size changed, may indicate binary incompatibility. Expected "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("144")]),e._v(" from C header, got "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("152")]),e._v(" from PyObject\n  "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("return")]),e._v(" f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("*args, **kwds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n/usr/local/lib/python3.7/importlib/_bootstrap.py:219: RuntimeWarning: greenlet.greenlet size changed, may indicate binary incompatibility. Expected "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("144")]),e._v(" from C header, got "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("152")]),e._v(" from PyObject\n  "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("return")]),e._v(" f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("*args, **kwds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n/usr/local/lib/python3.7/importlib/_bootstrap.py:219: RuntimeWarning: greenlet.greenlet size changed, may indicate binary incompatibility. Expected "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("144")]),e._v(" from C header, got "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("152")]),e._v(" from PyObject\n  "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("return")]),e._v(" f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("*args, **kwds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("h2",{attrs:{id:"问题分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题分析"}},[e._v("#")]),e._v(" 问题分析")]),e._v(" "),s("p",[s("code",[e._v("Python3.7")]),e._v("和"),s("code",[e._v("greenlet")]),e._v("版本不兼容，但项目没有直接使用"),s("code",[e._v("greenlet")]),e._v("的地方，由于"),s("code",[e._v("Gevent")]),e._v("底层基于"),s("code",[e._v("greenlet")]),e._v("实现，故大致定位到原因至"),s("code",[e._v("Gevent")]),e._v("包模块")]),e._v(" "),s("h2",{attrs:{id:"文本解决"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#文本解决"}},[e._v("#")]),e._v(" 文本解决")]),e._v(" "),s("p",[e._v("更新"),s("code",[e._v("Gevent")]),e._v("，使用非二进制的包重新安装"),s("code",[e._v("Gevent")]),e._v("以及它的依赖 [1]，问题解决")]),e._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("pip3 "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-U")]),e._v(" --force-reinstall --no-binary :all: gevent\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("附上参数说明")]),e._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("-U, "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("--upgrade")]),e._v("\nUpgrade all specified packages to the newest available version. The handling of dependencies depends on the upgrade-strategy used.\n--force-reinstall\nReinstall all packages even "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" they are already up-to-date.\n--no-binary "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("format_control"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\nDo not use binary packages. Can be supplied multiple times, and each "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("time")]),e._v(" adds to the existing value. Accepts either :all: to disable all binary packages, :none: to empty the set, or one or "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("more")]),e._v(" package names with commas between them. Note that some packages are tricky to compile and may fail to "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" when this option is used on them.\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("p",[e._v("注：实验环境"),s("code",[e._v("gevent==20.5.0")])]),e._v(" "),s("h2",{attrs:{id:"问题深入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题深入"}},[e._v("#")]),e._v(" 问题深入")]),e._v(" "),s("p",[e._v("官方已经修复该"),s("code",[e._v("BUG")]),e._v("，只需要升级"),s("code",[e._v("Gevent")]),e._v("至"),s("code",[e._v("20.9.0")]),e._v("即可 [2]，具体官方解读如下")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Ok, gevent wheels are built with greenlet 0.4.13. Something must have changed in the ABI of greenlet 0.4.14 (which was released last night).\n\nAs you discovered, building gevent from source should fix the issue, and I would expect installing greenlet==0.4.13 would as well.\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Please do not add unrelated comments to closed issues. Open a new issue if you have, well, a new issue.\n\ngevent 20.9.0 was released at the same time greenlet 0.4.17 was un-yanked. On Python 3.7 and higher, gevent 20.9.0 is required to use (a standard build of) greenlet 0.4.17.\n\ngevent 1.5 doesn't support Python 3.8.\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("p",[e._v("大致意思可以按上面的方式二进制编译安装升级解决问题，或将"),s("code",[e._v("Gevent")]),e._v("升级至"),s("code",[e._v("20.9.0")]),e._v("解决问题，对比校验后我采用了第二种方式")]),e._v(" "),s("p",[e._v("注：升级后环境"),s("code",[e._v("gevent==20.9.0、greenlet==1.0.0")])]),e._v(" "),s("h2",{attrs:{id:"参考文献"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考文献"}},[e._v("#")]),e._v(" 参考文献")]),e._v(" "),s("ul",[s("li",[e._v("[1] https://www.cnblogs.com/Eva-J/p/9396376.html")]),e._v(" "),s("li",[e._v("[2] https://github.com/gevent/gevent/issues/1260")])])])}),[],!1,null,null,null);s.default=n.exports}}]);