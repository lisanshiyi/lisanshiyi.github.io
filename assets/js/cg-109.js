(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{401:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"ä¸Šä¸‹æ–‡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ä¸Šä¸‹æ–‡"}},[s._v("#")]),s._v(" ä¸Šä¸‹æ–‡")]),s._v(" "),t("p",[s._v("ä¼ ç»Ÿ Python å•æœºç³»ç»Ÿéƒ¨ç½²ä¸­ï¼Œç”±äº GIL çš„å­˜åœ¨ï¼Œç›¸åŒè¿›ç¨‹ä¸­æˆ‘ä»¬å¯ä»¥ä¸ç”¨å¤„ç†å¹¶å‘é—®é¢˜ã€‚ä½†æ˜¯éšç€ä¸šåŠ¡å‘å±•éœ€è¦ï¼ŒåŸæœ‰å•æœºç³»ç»Ÿæ¼”å˜æˆåˆ†å¸ƒå¼æˆ–å¤šè¿›ç¨‹ç³»ç»Ÿåã€‚è¿™å°†ä½¿åŸæœ‰çš„å•æœºå•è¿›ç¨‹å¹¶å‘æ§åˆ¶ç­–ç•¥å¤±æ•ˆã€‚ä¸ºäº†è§£å†³è¯¥é—®é¢˜éœ€è¦å¼•å…¥ä¸€ç§è·¨è¿›ç¨‹ã€è·¨æœºå™¨çš„äº’æ–¥é”æœºåˆ¶æ¥æ§åˆ¶å…±äº«èµ„æºçš„è®¿é—®ï¼Œè¿™ä¹Ÿå°±æ˜¯åˆ†å¸ƒå¼é”çš„ç”±æ¥ã€‚")]),s._v(" "),t("p",[s._v("æ‰€ä»¥ï¼Œåˆ†å¸ƒå¼é”çš„å¼•å…¥æ˜¯ä¸ºäº†ä¿éšœå¤šå°æœºå™¨æˆ–å¤šä¸ªè¿›ç¨‹å¯¹å…±äº«èµ„æºè¯»å†™çš„åŒæ­¥ï¼Œä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚")]),s._v(" "),t("p",[s._v("åˆ†å¸ƒå¼é”å¤©ç”Ÿå…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š")]),s._v(" "),t("ul",[t("li",[s._v("äº’æ–¥æ€§ï¼šä»»ä½•æ—¶åˆ»ï¼Œåªå…è®¸å•å®¢æˆ·ç«¯ï¼ˆå•è¿›ç¨‹ã€å•èŠ‚ç‚¹ï¼‰èƒ½æŒæœ‰é”ã€‚")]),s._v(" "),t("li",[s._v("å®‰å…¨æ€§ï¼šèƒ½æœ‰æ•ˆé¿å…æ­»é”æƒ…å†µï¼Œå³ä½¿å®¢æˆ·ç«¯æŒæœ‰é”æœºå™¨å‘ç”Ÿå´©æºƒæˆ–é€€å‡ºæ•…éšœï¼Œä¹Ÿéœ€è¦ä¿éšœé”èƒ½è¢«æ­£ç¡®é‡Šæ”¾ã€‚")]),s._v(" "),t("li",[s._v("å¯ç”¨æ€§ï¼šå…·å¤‡é«˜å¯ç”¨èƒ½åŠ›ï¼Œé”æœåŠ¡èŠ‚ç‚¹æ•…éšœï¼ˆå³ä½¿å®•æœºï¼‰ä¹Ÿä¸åº”å½±å“æœåŠ¡çš„æ­£å¸¸è¿è¡Œã€‚")]),s._v(" "),t("li",[s._v("å¯é‡å…¥æ€§ï¼šé’ˆå¯¹åŒä¸€ä¸ªé”ï¼ŒåŠ é”å’Œè§£é”å¿…é¡»ä¸ºåŒä¸€ä¸ªè¿›ç¨‹ï¼Œå³å¯¹ç§°æ€§ã€‚")])]),s._v(" "),t("p",[s._v("å¸¸è§åˆ†å¸ƒå¼é”å®ç°æ–¹å¼ï¼š")]),s._v(" "),t("ul",[t("li",[s._v("æ•°æ®åº“ï¼šé‡‡ç”¨ä¹è§‚é”ã€æ‚²è§‚é”æˆ–ä¸»é”® ID å®ç°ã€‚")]),s._v(" "),t("li",[s._v("ç¼“å­˜ï¼šé‡‡ç”¨ Redis æˆ– RedLock (Redisç»„ä»¶) å®ç°ã€‚")]),s._v(" "),t("li",[s._v("ä¸€è‡´æ€§ç®—æ³•ï¼šé‡‡ç”¨ Zookeeperã€Chubby æˆ– Etcd å®ç°ã€‚")])]),s._v(" "),t("p",[s._v("ä»¥ä¸Šï¼Œå·ä¸»çŸ¥é“çš„å¸¸è§å®ç°å¤§è‡´å°±è¿™äº›äº†ã€‚æ¥ä¸‹æ¥çš„ç¯‡å¹…ä¸»è¦è®²è§£å¦‚ä½•ä½¿ç”¨ Etcd å®ç°åˆ†å¸ƒå¼é”ä¸šåŠ¡ï¼Œæˆ‘ä»¬å¾€ä¸‹çœ‹ã€‚")]),s._v(" "),t("h2",{attrs:{id:"åŸºäº-etcd-çš„åˆ†å¸ƒå¼é”å®ç°"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åŸºäº-etcd-çš„åˆ†å¸ƒå¼é”å®ç°"}},[s._v("#")]),s._v(" åŸºäº ETCD çš„åˆ†å¸ƒå¼é”å®ç°")]),s._v(" "),t("h3",{attrs:{id:"ç¯å¢ƒå®‰è£…"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç¯å¢ƒå®‰è£…"}},[s._v("#")]),s._v(" ç¯å¢ƒå®‰è£…")]),s._v(" "),t("p",[s._v("ä¸ºäº†ä¿è¯é”æœåŠ¡"),t("code",[s._v("å¯ç”¨æ€§")]),s._v("ï¼Œæˆ‘ä»¬æ­å»ºä¸€ä¸ªåŒ…å«ä¸‰ä¸ª Etcd èŠ‚ç‚¹çš„ docker é›†ç¾¤ç¯å¢ƒï¼Œæ­¤å¤„é€šè¿‡"),t("code",[s._v("docker-compose")]),s._v("è¿›è¡Œå®éªŒé…ç½®ã€‚ç†Ÿæ‚‰éƒ¨ç½²å®‰è£…çš„å·å‹ï¼Œå¯è·³è¿‡æ­¤éƒ¨åˆ†ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("æ­¥éª¤ä¸€ï¼šé•œåƒæ‹‰å–")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull bitnami/etcd:3.5.2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("æ­¥éª¤äºŒï¼šç¼–è¾‘docker-compose.yml")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("version: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.5'")]),s._v("\n\nservices:\n  etcd1:\n    container_name: builder-etcd1\n    image: bitnami/etcd:3.5.2\n    ports:\n      - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12379")]),s._v(":2379\n    environment:\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALLOW_NONE_AUTHENTICATION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_AUTO_COMPACTION_MODE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("revision\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_AUTO_COMPACTION_RETENTION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1002")]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_QUOTA_BACKEND_BYTES")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4294967296")]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_NAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("etcd1\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_ADVERTISE_PEER_URLS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd1:2380\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_LISTEN_PEER_URLS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://0.0.0.0:2380\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_LISTEN_CLIENT_URLS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://0.0.0.0:2379\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_ADVERTISE_CLIENT_URLS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd1:2379\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER_TOKEN")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("etcd-cluster\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("etcd1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd1:2380,etcd2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd2:2380,etcd3"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd3:2380\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER_STATE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("new\n    volumes:\n      - "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DOCKER_ROOT_DIR"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":-")]),s._v(".}")]),s._v("/volumes/etcd/data1:/bitnami/etcd\n\n  etcd2:\n    container_name: builder-etcd2\n    image: bitnami/etcd:3.5.2\n    ports:\n      - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22379")]),s._v(":2379\n    environment:\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALLOW_NONE_AUTHENTICATION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_AUTO_COMPACTION_MODE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("revision\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_AUTO_COMPACTION_RETENTION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1002")]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_QUOTA_BACKEND_BYTES")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4294967296")]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_NAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("etcd2\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_ADVERTISE_PEER_URLS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd2:2380\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_LISTEN_PEER_URLS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://0.0.0.0:2380\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_LISTEN_CLIENT_URLS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://0.0.0.0:2379\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_ADVERTISE_CLIENT_URLS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd2:2379\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER_TOKEN")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("etcd-cluster\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("etcd1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd1:2380,etcd2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd2:2380,etcd3"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd3:2380\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER_STATE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("new\n    volumes:\n      - "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DOCKER_ROOT_DIR"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":-")]),s._v(".}")]),s._v("/volumes/etcd/data2:/bitnami/etcd\n\n  etcd3:\n    container_name: builder-etcd3\n    image: bitnami/etcd:3.5.2\n    ports:\n      - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32379")]),s._v(":2379\n    environment:\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALLOW_NONE_AUTHENTICATION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_AUTO_COMPACTION_MODE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("revision\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_AUTO_COMPACTION_RETENTION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1002")]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_QUOTA_BACKEND_BYTES")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4294967296")]),s._v("\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_NAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("etcd3\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_ADVERTISE_PEER_URLS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd3:2380\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_LISTEN_PEER_URLS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://0.0.0.0:2380\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_LISTEN_CLIENT_URLS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://0.0.0.0:2379\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_ADVERTISE_CLIENT_URLS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd3:2379\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER_TOKEN")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("etcd-cluster\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("etcd1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd1:2380,etcd2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd2:2380,etcd3"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://etcd3:2380\n      - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_INITIAL_CLUSTER_STATE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("new\n    volumes:\n      - "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DOCKER_ROOT_DIR"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":-")]),s._v(".}")]),s._v("/volumes/etcd/data3:/bitnami/etcd\n\nnetworks:\n  default:\n    name: builder_dev\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br")])]),t("p",[s._v("éƒ¨ç½²é…ç½®æ–‡ä»¶ docker-compose.yml ä¸‹è½½ï¼Œè¯¦è§ "),t("code",[s._v("[1]")])]),s._v(" "),t("p",[t("strong",[s._v("æ­¥éª¤ä¸‰ï¼šå¯åŠ¨æœåŠ¡")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" docker-compose.yml up\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("æ­¥éª¤å››ï¼šéªŒè¯é›†ç¾¤")])]),s._v(" "),t("p",[s._v("éªŒè¯é›†ç¾¤èŠ‚ç‚¹çš„ç‰ˆæœ¬")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" builder-etcd1 /bin/bash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd --version"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" builder-etcd2 /bin/bash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd --version"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" builder-etcd3 /bin/bash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd --version"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¾“å‡º")]),s._v("\netcd Version: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.5")]),s._v(".2\nGit SHA: 99018a77b\nGo Version: go1.16.3\nGo OS/Arch: linux/amd64\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("éªŒè¯ä¸‰ä¸ªèŠ‚ç‚¹è¿”å›çš„æ•°æ®ä¸€è‡´")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" builder-etcd1 /bin/bash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcdctl put greeting '),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("hello, etcd"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# OK")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" builder-etcd1 /bin/bash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcdctl get greeting"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" builder-etcd2 /bin/bash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcdctl get greeting"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" builder-etcd3 /bin/bash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcdctl get greeting"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¾“å‡º")]),s._v("\ngreeting\nhello, etcd\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"é”çš„å®ç°åŸºç¡€æœºåˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é”çš„å®ç°åŸºç¡€æœºåˆ¶"}},[s._v("#")]),s._v(" é”çš„å®ç°åŸºç¡€æœºåˆ¶")]),s._v(" "),t("p",[s._v("æ­¤å¤„ä¸º Etcd æ ¸å¿ƒæœºåˆ¶ï¼Œä¸‹æ–‡è®²è§£çš„åˆ†å¸ƒå¼é”å°±æ˜¯åŸºäºè¿™äº›åŸºç¡€åŠŸèƒ½å’ŒåŸºç¡€ç‰¹æ€§å®ç°ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("Lease æœºåˆ¶")]),s._v("ï¼šå³ç§Ÿçº¦æœºåˆ¶ï¼ˆTTLï¼‰ï¼ŒEtcd å¯ä»¥ä¸ºå­˜å‚¨çš„ kv å¯¹è®¾ç½®ç§Ÿçº¦ï¼Œå½“ç§Ÿçº¦åˆ°æœŸï¼Œkv å°†å¤±æ•ˆåˆ é™¤ï¼›å½“ç„¶ä¹Ÿæ”¯æŒ refresh ç»­çº¦ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("Revision æœºåˆ¶")]),s._v("ï¼šå­˜å‚¨çš„æ¯ä¸ª key å¸¦æœ‰ä¸€ä¸ª Revision å±æ€§å€¼ï¼ŒEtcd æ¯è¿›è¡Œä¸€æ¬¡äº‹åŠ¡æ“ä½œï¼Œå¯¹åº”çš„å…¨å±€ Revision å€¼éƒ½ä¼šåŠ ä¸€ï¼Œå› æ­¤æ¯ä¸ª key å¯¹åº”çš„ Revision å±æ€§å€¼éƒ½æ˜¯å…¨å±€å”¯ä¸€çš„ã€‚é€šè¿‡æ¯”è¾ƒ Revision çš„å¤§å°å°±èƒ½çŸ¥é“å†™æ“ä½œçš„é¡ºåºã€‚")]),s._v(" "),t("p",[t("strong",[s._v("å…¬å¹³é”æœºåˆ¶")]),s._v("ï¼šå¤šä¸ªç¨‹åºåŒæ—¶æŠ¢é”æ—¶ï¼Œä¼šæ ¹æ® Revision å€¼å¤§å°ä¾æ¬¡è·å¾—é”ï¼Œå¯ä»¥æœ‰æ•ˆé¿å… â€œæƒŠç¾¤æ•ˆåº”â€ï¼Œå…¬å¹³è·å–ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("Prefix æœºåˆ¶")]),s._v("ï¼šå³å‰ç¼€æœºåˆ¶ï¼Œå¯ä»¥æ ¹æ®å‰ç¼€è·å–è¯¥ç›®å½•ä¸‹æ‰€æœ‰çš„ key åŠå¯¹åº”çš„å±æ€§ï¼ˆåŒ…æ‹¬ key, value ä»¥åŠ revision ç­‰ï¼‰ã€‚")]),s._v(" "),t("p",[t("strong",[s._v("Watch æœºåˆ¶")]),s._v("ï¼šå³ç›‘å¬æœºåˆ¶ï¼ŒWatch æœºåˆ¶æ”¯æŒ Watch æŸä¸ªå›ºå®šçš„ keyï¼Œä¹Ÿæ”¯æŒ Watch ä¸€ä¸ªç›®å½•ï¼ˆå‰ç¼€æœºåˆ¶ï¼‰ï¼Œå½“è¢« Watch çš„ key æˆ–ç›®å½•å‘ç”Ÿå˜åŒ–ï¼Œå®¢æˆ·ç«¯å°†æ”¶åˆ°é€šçŸ¥ï¼ˆğŸ®ğŸ®ğŸ®ï¼‰ã€‚")]),s._v(" "),t("h3",{attrs:{id:"é”çš„å®ç°é€»è¾‘"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#é”çš„å®ç°é€»è¾‘"}},[s._v("#")]),s._v(" é”çš„å®ç°é€»è¾‘")]),s._v(" "),t("p",[s._v("åœ¨ Etcd çš„ clientv3 åŒ…ä¸­ï¼Œå®˜æ–¹å®ç°äº†åˆ†å¸ƒå¼é”ï¼Œä¸ºäº†äº†è§£å®ƒçš„å·¥ä½œæœºåˆ¶å’Œå®ç°é€»è¾‘ï¼Œæˆ‘ä»¬å…ˆåšä¸€ä¸ªç®€å•çš„"),t("strong",[s._v("æ¨¡æ‹Ÿä½¿ç”¨")]),s._v("ã€‚")]),s._v(" "),t("p",[s._v("ä¸‹é¢æˆ‘ä»¬é€šè¿‡"),t("code",[s._v("etcdctl")]),s._v("è¿›è¡Œé”æ¨¡æ‹Ÿã€‚")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç»ˆç«¯ 1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" builder-etcd1 /bin/bash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcdctl lock /lock/kv/uuid_a"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /lock/kv/uuid_a/12f78036a2766634")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç»ˆç«¯ 2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" builder-etcd2 /bin/bash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcdctl lock /lock/kv/uuid_a"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç»ˆç«¯ 3")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" builder-etcd3 /bin/bash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcdctl lock /lock/kv/uuid_a"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç»ˆç«¯ 1 ç»“æŸï¼Œæ˜¾ç¤ºç»ˆç«¯ 2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /lock/kv/uuid_a/41ce8036a27a471d")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç»ˆç«¯ 2 ç»“æŸï¼Œæ˜¾ç¤ºç»ˆç«¯ 3")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /lock/kv/uuid_a/58538036a276e81f")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("ç”±ä¸Šï¼Œä¸‰ä¸ªä¸åŒèŠ‚ç‚¹åŒæ—¶å¯¹"),t("code",[s._v("/lock/kv/uuid_a")]),s._v("è¿›è¡ŒåŠ é”ï¼Œä½†æ˜¯å´è¢«ä¾æ¬¡è·å¾—é”ï¼ˆç®€å•æ¼”ç¤ºï¼Œçœ‹çœ‹å°±è¡Œï¼ï¼‰ã€‚")]),s._v(" "),t("p",[s._v("é€šè¿‡è§£ææºç ï¼Œå‘ç° Etcd åˆ†å¸ƒå¼é”çš„å®ç°ä¸»è¦é›†ä¸­åœ¨ "),t("code",[s._v("go.etcd.io/etcd/client/v3/concurrency")]),s._v(" åŒ…ä¸­ï¼Œé€šè¿‡ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•è¿›è¡Œæä¾›ï¼š")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewMutex")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("Session"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pfx "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("Mutex        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ–°å»ºä¸€ä¸ª Mutex å¯¹è±¡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("m "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("Mutex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ctx context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("error")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è·å–é”ï¼Œé˜»å¡è°ƒç”¨")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("m "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("Mutex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Unlock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ctx context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("error")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é‡Šæ”¾é”")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("ç”±ä¸Šï¼Œä½¿ç”¨ Etcd æä¾›åˆ†å¸ƒå¼é”å˜å¾—æ¯”é¢„æœŸç®€å•è®¸å¤šï¼Œé¦–å…ˆå®ä¾‹åŒ–ä¸€ä¸ª"),t("code",[s._v("Mutex")]),s._v("å¯¹è±¡ï¼Œç„¶å"),t("code",[s._v("Lock")]),s._v("å°è¯•æŠ¢å é”ï¼Œä¹‹åè¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œæœ€å"),t("code",[s._v("Unlock")]),s._v("é‡Šæ”¾é”å³å¯ã€‚")]),s._v(" "),t("p",[s._v("æˆ‘ä»¬å…ˆçœ‹çœ‹"),t("code",[s._v("Lock")]),s._v("å‡½æ•°çš„å®ç°åŸç†ï¼Œå…·ä½“å¦‚ä¸‹ï¼š")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Lock locks the mutex with a cancelable context. If the context is canceled")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// while trying to acquire the lock, the mutex tries to clean its stale lock entry.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("m "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("Mutex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Lock")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ctx context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("error")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tresp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryAcquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("m "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("Mutex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tryAcquire")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ctx context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("v3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TxnResponse"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("error")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\ts "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("s\n\tclient "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Client")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\tm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("myKey "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fmt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Sprintf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%s%x"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pfx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Lease")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tcmp "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" v3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Compare")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("CreateRevision")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("myKey"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"="')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// put self in lock waiters via myKey; oldest waiter holds lock")]),s._v("\n\tput "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" v3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("OpPut")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("myKey"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("WithLease")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Lease")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// reuse key in case this session already holds the lock")]),s._v("\n\tget "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" v3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("OpGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("myKey"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// fetch current holder to complete uncontended path with only one RPC")]),s._v("\n\tgetOwner "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" v3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("OpGet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pfx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("WithFirstCreate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tresp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Txn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("If")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cmp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Then")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("put"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" getOwner"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Else")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("get"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" getOwner"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Commit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\tm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("myRev "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" resp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Header"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Revision\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("resp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Succeeded "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("myRev "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" resp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Responses"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("GetResponseRange")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Kvs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CreateRevision\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" resp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("p",[s._v("é¦–å…ˆé€šè¿‡ä¸€ä¸ªäº‹åŠ¡æ¥å°è¯•åŠ é”ï¼Œäº‹åŠ¡å›´ç»•ç€ç”± "),t("code",[s._v("m.pfx")]),s._v(" å’Œ "),t("code",[s._v("s.Lease()")]),s._v(" ç»„æˆçš„ Keyï¼ŒåŒ…å« 4 ä¸ªåŸºç¡€æ“ä½œï¼š"),t("code",[s._v("cmp")]),s._v("ã€"),t("code",[s._v("put")]),s._v("ã€"),t("code",[s._v("get")]),s._v("ã€"),t("code",[s._v("getOwner")]),s._v("ï¼Œå…·ä½“å¦‚ä¸‹ï¼š")]),s._v(" "),t("ul",[t("li",[s._v("cmpï¼šæ¯”è¾ƒ Key çš„ Revision ç‰ˆæœ¬æ˜¯å¦ä¸º 0ï¼Œå…¶ä¸­ 0 ä»£è¡¨è¯¥é”ä¸å­˜åœ¨")]),s._v(" "),t("li",[s._v("putï¼šå‘ Key ä¸­å­˜å‚¨è¶…æ—¶æ—¶é—´ä¸º Session é»˜è®¤æ—¶é•¿çš„ç©ºå€¼ï¼ˆåŠ é”æ“ä½œï¼‰")]),s._v(" "),t("li",[s._v("getï¼šé€šè¿‡ Key æŸ¥è¯¢å†™å…¥")]),s._v(" "),t("li",[s._v("getOwnerï¼šç”±äºå…¶ä»– Session ä¹Ÿç”¨åŒæ · m.pfx åŠ é”ï¼Œä¸”æ¯ä¸ª LeaseID ä¸åŒã€‚é€šè¿‡ m.pfx å’Œ WithFirstCreate()æ¥æŸ¥è¯¢ï¼Œç¬¬ä¸€æ¬¡è‚¯å®šä¼š put æˆåŠŸï¼Œä½†ä¹Ÿåªæœ‰æœ€æ—©ä½¿ç”¨è¿™ä¸ª pfx çš„ Session æ‰æ˜¯æŒæœ‰é”çš„ï¼Œæ‰€ä»¥è¿™ä¸ª getOwner æ˜¯è¯¥äº‹åŠ¡çš„å…³é”®ã€‚")])]),s._v(" "),t("p",[s._v("æ•´ä¸ªåˆ†å¸ƒå¼é”çš„å®ç°æ–¹å¼ï¼Œé€šè¿‡ç»Ÿä¸€çš„"),t("code",[s._v("å‰ç¼€ m.pfx")]),s._v("æ¥ putï¼Œç„¶åæ ¹æ®å„è‡ªçš„"),t("code",[s._v("Revision")]),s._v("ç‰ˆæœ¬å·æ¥æ’é˜Ÿè·å–é”ï¼Œé¿å…äº†æƒŠç¾¤æ•ˆåº”ï¼Œæ•ˆç‡éå¸¸é«˜ã€‚")]),s._v(" "),t("p",[t("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://files.mdnice.com/user/12678/4228508d-c89f-462b-bd35-87e208de3193.png",loading:"lazy"}})]),s._v(" "),t("p",[s._v("å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå…±æœ‰ 4 ä¸ª Session è¿›è¡ŒåŠ é”ï¼Œæ ¹æ® Revision æ’é˜Ÿè§„åˆ™ï¼Œæœ€ç»ˆè·å–é”çš„é¡ºåºåˆ†åˆ«ä¸ºï¼š"),t("code",[s._v("Session2 -> Session3 -> Session1 -> Session4")]),s._v("ã€‚")]),s._v(" "),t("p",[s._v("å¥½äº†ï¼Œåˆ†å¸ƒå¼ç›¸å…³çŸ¥è¯†ç‚¹å°±è®²è§£å®Œäº†ï¼Œè®²çœŸ"),t("code",[s._v("Watchæœºåˆ¶")]),s._v("æ˜¯æˆ‘çš„æœ€çˆ±ï¼Œå¹³æ—¶é¡¹ç›®ä¸­ä½¿ç”¨ä¹Ÿæœ€å¤šã€‚ä½†å†æ¬¡çœ‹å®Œè¿™éƒ¨åˆ†åŸç†åï¼Œå‘ç°"),t("code",[s._v("Revisionæœºåˆ¶")]),s._v("çš„å®ç°çœŸçš„å¾ˆå·§å¦™ï¼Œä¸å¾—ä¸ä½©æœè¿™å¸®å·¨ä½¬ã€‚")]),s._v(" "),t("h3",{attrs:{id:"python-åˆ†å¸ƒå¼é”ä½¿ç”¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#python-åˆ†å¸ƒå¼é”ä½¿ç”¨"}},[s._v("#")]),s._v(" Python åˆ†å¸ƒå¼é”ä½¿ç”¨")]),s._v(" "),t("p",[s._v("æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ Etcd v3 ç‰ˆ SDK è¿›è¡Œä¸€ä¸ªç®€å•çš„ä¸šåŠ¡ä½¿ç”¨ï¼ŒæŸ¥éå…¨ç½‘ä¼¼ä¹åªæœ‰ python-etcd3 [2] è¿™ä¸ªå°ä¼—åŒ…ï¼Œå·å‹ä»¬å°†å°±ç”¨ï¼Œåˆ«åæ§½ã€‚")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -*- coding: utf-8 -*-")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" time\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" etcd3\n\netcd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" etcd3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'127.0.0.1'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nlock_name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"uuid_a"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å®ç° A")]),s._v("\nlock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" etcd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ttl"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nlock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("acquire"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("is_acquired"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è·å–åŠ é”çŠ¶æ€ æˆ– å…·ä½“ä¸šåŠ¡")]),s._v("\nlock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("release"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å®ç° B(æ¨è)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" etcd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ttl"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("is_acquired"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è·å–åŠ é”çŠ¶æ€ æˆ– å…·ä½“ä¸šåŠ¡")]),s._v("\n    lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("refresh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h2",{attrs:{id:"ç»“è¯­"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ç»“è¯­"}},[s._v("#")]),s._v(" ç»“è¯­")]),s._v(" "),t("p",[s._v("æœ¬æ–‡ä»åŸºç¡€æ¦‚å¿µã€Etcd å®ç°åŸç†ã€Python ä¸šåŠ¡åº”ç”¨è§’åº¦å¯¹åˆ†å¸ƒå¼é”è¿›è¡Œå‰–æå­¦ä¹ ï¼Œé™äºç¯‡å¹…å’Œä¸ªäººæ°´å¹³ï¼ŒGoç›¸å…³å†…å®¹æ²¡æœ‰è¿›è¡Œç»§ç»­æ·±å…¥ã€‚")]),s._v(" "),t("p",[s._v("Etcd3.0 ç›¸å¯¹äº 2.0 ç‰ˆæœ¬ï¼Œå®˜æ–¹ä½¿ç”¨ gRPC æ›¿æ¢ JSONï¼Œåœ¨æ•ˆç‡ã€å¯é æ€§ã€å¯æ‰©å±•æ€§å’Œæ˜“ç”¨æ€§ç­‰æ–¹é¢éƒ½æœ‰äº†å¾ˆå¤§è¿›æ­¥ã€‚")]),s._v(" "),t("p",[s._v("Python å¯¹ 3.0 ç‰ˆæœ¬æ”¯æŒè¾ƒå¼±ï¼Œä¸»è¦ä½“ç°åœ¨æ²¡æœ‰ç¨³å®šçš„ SDK åŒ…ï¼Œä¸”å¤§éƒ¨åˆ†åŒ…å¯¹ Python çš„ç‰ˆæœ¬æ”¯æŒä¹Ÿä»…é™äº <= 3.7(ğŸ˜’)ã€‚")]),s._v(" "),t("h2",{attrs:{id:"å‚è€ƒæ–‡ä»¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‚è€ƒæ–‡ä»¶"}},[s._v("#")]),s._v(" å‚è€ƒæ–‡ä»¶")]),s._v(" "),t("ul",[t("li",[s._v("[1] https://github.com/liyaodev/docker-compose")]),s._v(" "),t("li",[s._v("[2] https://github.com/kragniz/python-etcd3/tree/master")])])])}),[],!1,null,null,null);t.default=e.exports}}]);