(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{361:function(s,a,t){"use strict";t.r(a);var n=t(7),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"问题现象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题现象"}},[s._v("#")]),s._v(" 问题现象")]),s._v(" "),a("ul",[a("li",[s._v("1.服务CPU利用率达到99%，持续不下降")]),s._v(" "),a("li",[s._v("2.服务CPU利用率突然下降低至0%，请求卡住")])]),s._v(" "),a("h3",{attrs:{id:"问题解决"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题解决"}},[s._v("#")]),s._v(" 问题解决")]),s._v(" "),a("h4",{attrs:{id:"算法优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#算法优化"}},[s._v("#")]),s._v(" 算法优化")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("对比发现：\n    600kb图片请求一次服务需要1s内返回结果\n    1.3M图片请求一次服务需要20s返回结果\n具体解决：\n    查询发现为pyzbar组件问题，适合进行小图分析，不适合大图分析\n处理逻辑：\n    加一层检测算法，检测初二维码图片，进行缩放后进行后续的pyzbar识别处理\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"服务问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务问题"}},[s._v("#")]),s._v(" 服务问题")]),s._v(" "),a("ul",[a("li",[s._v("查看卡死进程相关信息：https://blog.csdn.net/chroming/article/details/82057397")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    所需组件：strace、lsof\n    查看进程号：ps auxf\n    查看进程卡在那个进程回调：strace -p 7（发现有很多死循环socket监听请求）\n    查看进程所有文件：lsof -p 7(用处不大)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("查看进程运行代码相关信息：https://mozillazg.com/2017/07/debug-running-python-process-with-gdb.html")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    所需组件：gdb python2.7-dbg\n    查看调试中的进程：gdb python 7\n    查看调试中进程代码：py-list、py-bt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("通过上面发现代码timeout等待在waitress调用中")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    查找各种无果，最终发现为组件bug，具体见：https://github.com/Pylons/waitress/issues/218\n    处理措施：使用Gevent进行服务部署，替换waitress\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("备注：\n1.strace：可查看卡死的进程级别的原因\n2.gdb和python2.7-dbg：可查看卡死进程的具体运行中代码")])])}),[],!1,null,null,null);a.default=e.exports}}]);