(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{375:function(a,e,s){"use strict";s.r(e);var t=s(7),r=Object(t.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h3",{attrs:{id:"概述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[a._v("#")]),a._v(" 概述")]),a._v(" "),e("ul",[e("li",[a._v("为了让尝试“以图搜图”的相似图片检索的场景，基于Faiss向量索引计算和图片特征提取模型 VGG16 设计了一个以图搜图系统。")]),a._v(" "),e("li",[a._v("开源地址："),e("a",{attrs:{href:"https://github.com/liyaodev/image-retrieval",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://github.com/liyaodev/image-retrieval"),e("OutboundLink")],1)])]),a._v(" "),e("h3",{attrs:{id:"检索场景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#检索场景"}},[a._v("#")]),a._v(" 检索场景")]),a._v(" "),e("ul",[e("li",[a._v("推理流程：读取图片，算法生成特征向量")]),a._v(" "),e("li",[a._v("特征入库：把特征向量存入ES中")]),a._v(" "),e("li",[a._v("检索流程：线上实时向量检索")]),a._v(" "),e("li",[a._v("具体流程如下图："),e("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://lisanshiyi.com/assets/other/notes/image-vector-retrieval-4-1.jpg",loading:"lazy"}})])]),a._v(" "),e("h3",{attrs:{id:"faiss简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#faiss简介"}},[a._v("#")]),a._v(" Faiss简介")]),a._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://github.com/facebookresearch/faiss",target:"_blank",rel:"noopener noreferrer"}},[a._v("faiss"),e("OutboundLink")],1),a._v("是为稠密向量提供高效相似度搜索和聚类的框架。由Facebook AI Research研发。 具有以下特性。\n"),e("ul",[e("li",[a._v("提供多种检索方法")]),a._v(" "),e("li",[a._v("速度快")]),a._v(" "),e("li",[a._v("可存在内存和磁盘中")]),a._v(" "),e("li",[a._v("C++实现，提供Python封装调用。")]),a._v(" "),e("li",[a._v("大部分算法支持GPU实现")])])])]),a._v(" "),e("h3",{attrs:{id:"faiss检索实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#faiss检索实现"}},[a._v("#")]),a._v(" Faiss检索实现")]),a._v(" "),e("ul",[e("li",[a._v("提供欧氏和内积两种种距离方式，具体代码如下：")])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("import faiss                   # make faiss available\nindex = faiss.IndexFlatL2(d)   # build the index\nindex.add(xb)                  # add vectors to the index\nD, I = index.search(xq, k)     # actual search\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("import faiss                   # make faiss available\nindex = faiss.IndexFlatIP(d)   # build the index\nindex.add(xb)                  # add vectors to the index\nD, I = index.search(xq, k)     # actual search\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br")])]),e("h3",{attrs:{id:"操作简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#操作简介"}},[a._v("#")]),a._v(" 操作简介")]),a._v(" "),e("ul",[e("li",[a._v("下载工程源码："),e("a",{attrs:{href:"https://github.com/liyaodev/image-retrieval",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://github.com/liyaodev/image-retrieval"),e("OutboundLink")],1)]),a._v(" "),e("li",[a._v("操作一：构建基础索引")])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("python index.py\n--train_data：自定义训练图片文件夹路径，默认为`<ROOT_DIR>/data/train`\n--index_file：自定义索引文件存储路径，默认为`<ROOT_DIR>/index/train.h5`\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("ul",[e("li",[a._v("操作二：使用相似检索")])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("python retrieval.py --engine=faiss\n--test_data：自定义测试图片详细地址，默认为`<ROOT_DIR>/data/test/001_accordion_image_0001.jpg`\n--index_file：自定义索引文件存储路径，默认为`<ROOT_DIR>/index/train.h5`\n--db_name：自定义ES或者Milvus索引库名，默认为`image_retrieval`\n--engine：自定义检索引擎类型，默认为`numpy`，可选包括：numpy、faiss、es、milvus\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br")])]),e("h3",{attrs:{id:"扩展阅读"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#扩展阅读"}},[a._v("#")]),a._v(" 扩展阅读")]),a._v(" "),e("ul",[e("li",[a._v("检索速度优化"),e("a",{attrs:{href:"https://github.com/facebookresearch/faiss/wiki/Faster-search",target:"_blank",rel:"noopener noreferrer"}},[a._v("方案"),e("OutboundLink")],1)]),a._v(" "),e("li",[a._v("索引内存优化"),e("a",{attrs:{href:"https://github.com/facebookresearch/faiss/wiki/Lower-memory-footprint",target:"_blank",rel:"noopener noreferrer"}},[a._v("方案"),e("OutboundLink")],1)]),a._v(" "),e("li",[a._v("GPU运行推理"),e("a",{attrs:{href:"https://github.com/facebookresearch/faiss/wiki/Running-on-GPUs",target:"_blank",rel:"noopener noreferrer"}},[a._v("方案"),e("OutboundLink")],1)])]),a._v(" "),e("hr"),a._v(" "),e("p",[a._v("That's all!")])])}),[],!1,null,null,null);e.default=r.exports}}]);