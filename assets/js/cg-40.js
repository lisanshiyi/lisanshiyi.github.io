(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{332:function(s,a,n){"use strict";n.r(a);var t=n(7),l=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("ul",[a("li",[s._v("在这些图中，Python解释器刻度线沿X轴显示。\n"),a("ul",[a("li",[s._v("两个横条表示正在执行的两个不同线程。")]),s._v(" "),a("li",[s._v("白色区域表示线程完全空闲的时间。")]),s._v(" "),a("li",[s._v("绿色区域指示线程何时保持GIL并正在运行。")]),s._v(" "),a("li",[s._v("红色区域指示操作系统何时仅计划线程将其唤醒，并发现GIL不可用。")])])]),s._v(" "),a("li",[s._v("详见以下图例：")])]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://lisanshiyi.com/assets/language/python/GIL-2-1.jpg",loading:"lazy"}})]),s._v(" "),a("ul",[a("li",[s._v("首先，这是在单个CPU系统上运行两个CPU绑定线程的行为。\n"),a("ul",[a("li",[s._v("经过长时间的计算，线程之间会很好地交替。")])])]),s._v(" "),a("li",[s._v("详见以下图例：")])]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://lisanshiyi.com/assets/language/python/GIL-2-2.jpg",loading:"lazy"}})]),s._v(" "),a("ul",[a("li",[s._v("其次，双核笔记本机器上启动代码。\n"),a("ul",[a("li",[s._v("所有这些红色区域表示操作系统已在一个内核上调度了Python线程的时间，但由于另一个内核上的线程持有该线程而无法运行。")])])])]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://lisanshiyi.com/assets/language/python/GIL-2-3.jpg",loading:"lazy"}})]),s._v(" "),a("ul",[a("li",[s._v("涉及一个I／O绑定线程与CPU绑定线程竞争。在此示例中，I／O线程仅回显UDP数据包。这是该线程的代码。")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("def thread_1（端口）：\n    s =套接字（AF_INET，SOCK_DGRAM）\n    s.bind（（“”，port））\n    而True：\n        msg，addr = s.recvfrom（1024）\n        s.sendto（msg，addr）\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("ul",[a("li",[s._v("另一个线程（线程2）只是在无意识地旋转。此图显示了向线程1发送UDP消息时发生的情况。")])]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://lisanshiyi.com/assets/language/python/GIL-2-4.jpg",loading:"lazy"}})]),s._v(" "),a("ul",[a("li",[s._v("如您所料，大部分时间都花在运行CPU绑定线程上。但是，当接收到I/O时，I/O线程中会发生一系列活动。让我们放大该区域，看看发生了什么。")])]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"","data-src":"https://lisanshiyi.com/assets/language/python/GIL-2-5.jpg",loading:"lazy"}})]),s._v(" "),a("ul",[a("li",[s._v("在此图中，您将看到为完成少量处理而使I/O绑定到GIL的难度。")]),s._v(" "),a("li",[s._v("在UDP消息的到达与s.recvfrom()调用的成功返回之间传递了大约17000个解释器滴答声（并注意所有GIL争用）")]),s._v(" "),a("li",[s._v("在执行s.sendto()与循环返回下一个s.recvfrom()之间传递了34000多个滴答。")])]),s._v(" "),a("blockquote",[a("p",[s._v("简单的结论就是：Python的多线程在多核CPU上，只对于I/O密集型计算产生正面效果；而当有至少有一个CPU密集型线程存在，那么多线程效率会由于GIL而大幅下降。")])]),s._v(" "),a("ul",[a("li",[s._v("速度测试")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("import time\n\nCOUNT = 10000000\nstart = time.clock()\ndef countdown(n):\n    while n > 0:\n        n -= 1\ncountdown(COUNT)\nprint(\"Time used:\",(time.clock() - start))\n# ('Time used:', 0.392953)\n\nimport time\nfrom threading import Thread\nCOUNT = 10000000\nstart = time.clock()\ndef countdown(n):\n    while n > 0:\n        n -= 1\nt1 = Thread(target=countdown, args=[COUNT // 2])\nt2 = Thread(target=countdown, args=[COUNT // 2])\nt1.start()\nt2.start()\nt1.join()\nt2.join()\nprint(\"Time used:\",(time.clock() - start))\n# ('Time used:', 0.910045)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])])])}),[],!1,null,null,null);a.default=l.exports}}]);