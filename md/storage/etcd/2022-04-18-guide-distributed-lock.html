<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>åŸºç¡€ç¯‡ï¼šetcd 3.0 å®ç°åˆ†å¸ƒå¼é” | æä¸‰åä¸€çš„ä¸ªäººç½‘ç«™</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <script charset="utf-8" async="async" src="/js/jquery.min.js"></script>
    <script charset="utf-8" async="async" src="/js/global.js"></script>
    <script charset="utf-8" async="async" src="/js/fingerprint2.min.js"></script>
    <script>
            var _hmt = _hmt || [];
            (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?c03de854d3cd39bfe134ce906d614b82";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
            })();
            </script>
    <meta name="description" content="æä¸‰åä¸€çš„ä¸ªäººç½‘ç«™ï¼Œè‡´åŠ›äºåˆ†äº«å’Œæç‚¼ç¼–ç¨‹æŠ€æœ¯ï¼Œè®©ä¼˜è´¨ä¸°å¯Œçš„æŠ€æœ¯ä¿¡æ¯å¾—åˆ°å…¨é¢å¯é çš„å…±äº«ï¼Œä¿ƒä½¿ä¿¡æ¯åˆ›é€ ä»·å€¼ã€‚">
    <meta property="article:modified_time" content="2023-01-04T12:14:06.000Z">
    <meta property="og:title" content="åŸºç¡€ç¯‡ï¼šetcd 3.0 å®ç°åˆ†å¸ƒå¼é”">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/md/storage/etcd/2022-04-18-guide-distributed-lock.html">
    <meta name="twitter:title" content="åŸºç¡€ç¯‡ï¼šetcd 3.0 å®ç°åˆ†å¸ƒå¼é”">
    <meta name="twitter:url" content="/md/storage/etcd/2022-04-18-guide-distributed-lock.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="robots" content="all">
    <meta name="author" content="æä¸‰åä¸€">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="keywords" content="æä¸‰åä¸€ï¼Œæä¸‰åä¸€çš„ä¸ªäººç½‘ç«™ï¼ŒLiSanShiYiï¼ŒPythonï¼Œåˆ†å¸ƒå¼ï¼Œæ•°æ®åº“ï¼Œäº‘åŸç”Ÿï¼Œå¤§æ•°æ®ï¼Œç®—æ³•">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="/assets/css/0.styles.06e10c60.css" as="style"><link rel="preload" href="/assets/css/styles.css?v=1672834611655" as="style"><link rel="preload" href="/assets/js/cg-styles.js?v=1672834611655" as="script"><link rel="preload" href="/assets/js/cg-app.js?v=1672834611655" as="script"><link rel="preload" href="/assets/js/cg-3.js?v=1672834611655" as="script"><link rel="preload" href="/assets/js/cg-4.js?v=1672834611655" as="script"><link rel="preload" href="/assets/js/cg-109.js?v=1672834611655" as="script"><link rel="preload" href="/assets/js/cg-5.js?v=1672834611655" as="script"><link rel="preload" href="/assets/js/cg-6.js?v=1672834611655" as="script">
    <link rel="stylesheet" href="/assets/css/0.styles.06e10c60.css"><link rel="stylesheet" href="/assets/css/styles.css?v=1672834611655">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">æä¸‰åä¸€çš„ä¸ªäººç½‘ç«™</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/md/about/platform/guide2reading.html" class="nav-link">
  å¯¼è¯»
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è¯­è¨€åŸºç¡€" class="dropdown-title"><span class="title">è¯­è¨€åŸºç¡€</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/language/python/default.html" class="nav-link">
  Python
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç½‘ç»œæŠ€æœ¯" class="dropdown-title"><span class="title">ç½‘ç»œæŠ€æœ¯</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/network/grpc/default.html" class="nav-link">
  gRPC
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å­˜å‚¨æŠ€æœ¯" class="dropdown-title"><span class="title">å­˜å‚¨æŠ€æœ¯</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/storage/etcd/default.html" class="nav-link">
  etcd
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æºç è§£æ" class="dropdown-title"><span class="title">æºç è§£æ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/sourcecode/requests/default.html" class="nav-link">
  Requests
</a></li><li class="dropdown-item"><!----> <a href="/md/sourcecode/urllib3/default.html" class="nav-link">
  urllib3
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å…¶ä»–æ—¥å¸¸" class="dropdown-title"><span class="title">å…¶ä»–æ—¥å¸¸</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/other/tools/default.html" class="nav-link">
  å·¥å…·æ¨è
</a></li><li class="dropdown-item"><!----> <a href="/md/other/issues/default.html" class="nav-link">
  é—®é¢˜è§£ç­”
</a></li><li class="dropdown-item"><!----> <a href="/md/other/notes/default.html" class="nav-link">
  éšç¬”æ—¥è®°
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å…³äº" class="dropdown-title"><span class="title">å…³äº</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/about/me/default.html" class="nav-link">
  å…³äºç«™é•¿
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/liyaodev" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/md/about/platform/default.html" class="nav-link">
  å…³äºå°ç«™
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/md/about/platform/guide2reading.html" class="nav-link">
  å¯¼è¯»
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="è¯­è¨€åŸºç¡€" class="dropdown-title"><span class="title">è¯­è¨€åŸºç¡€</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/language/python/default.html" class="nav-link">
  Python
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç½‘ç»œæŠ€æœ¯" class="dropdown-title"><span class="title">ç½‘ç»œæŠ€æœ¯</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/network/grpc/default.html" class="nav-link">
  gRPC
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å­˜å‚¨æŠ€æœ¯" class="dropdown-title"><span class="title">å­˜å‚¨æŠ€æœ¯</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/storage/etcd/default.html" class="nav-link">
  etcd
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æºç è§£æ" class="dropdown-title"><span class="title">æºç è§£æ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/sourcecode/requests/default.html" class="nav-link">
  Requests
</a></li><li class="dropdown-item"><!----> <a href="/md/sourcecode/urllib3/default.html" class="nav-link">
  urllib3
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å…¶ä»–æ—¥å¸¸" class="dropdown-title"><span class="title">å…¶ä»–æ—¥å¸¸</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/other/tools/default.html" class="nav-link">
  å·¥å…·æ¨è
</a></li><li class="dropdown-item"><!----> <a href="/md/other/issues/default.html" class="nav-link">
  é—®é¢˜è§£ç­”
</a></li><li class="dropdown-item"><!----> <a href="/md/other/notes/default.html" class="nav-link">
  éšç¬”æ—¥è®°
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å…³äº" class="dropdown-title"><span class="title">å…³äº</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/about/me/default.html" class="nav-link">
  å…³äºç«™é•¿
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/liyaodev" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="/md/about/platform/default.html" class="nav-link">
  å…³äºå°ç«™
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>etcd</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/storage/etcd/2022-04-18-guide-distributed-lock.html" aria-current="page" class="active sidebar-link">åŸºç¡€ç¯‡ï¼šetcd 3.0 å®ç°åˆ†å¸ƒå¼é”</a></li><li><a href="/md/storage/etcd/2022-06-05-guide-base.html" class="sidebar-link">å…¥é—¨ç¯‡ï¼šetcdçš„å®‰è£…éƒ¨ç½²å’Œä½¿ç”¨å§¿åŠ¿</a></li></ul></section></li></ul> </aside> <div><main class="page"> <div class="theme-default-content content__default"><h2 id="ä¸Šä¸‹æ–‡"><a href="#ä¸Šä¸‹æ–‡" class="header-anchor">#</a> ä¸Šä¸‹æ–‡</h2> <p>ä¼ ç»Ÿ Python å•æœºç³»ç»Ÿéƒ¨ç½²ä¸­ï¼Œç”±äº GIL çš„å­˜åœ¨ï¼Œç›¸åŒè¿›ç¨‹ä¸­æˆ‘ä»¬å¯ä»¥ä¸ç”¨å¤„ç†å¹¶å‘é—®é¢˜ã€‚ä½†æ˜¯éšç€ä¸šåŠ¡å‘å±•éœ€è¦ï¼ŒåŸæœ‰å•æœºç³»ç»Ÿæ¼”å˜æˆåˆ†å¸ƒå¼æˆ–å¤šè¿›ç¨‹ç³»ç»Ÿåã€‚è¿™å°†ä½¿åŸæœ‰çš„å•æœºå•è¿›ç¨‹å¹¶å‘æ§åˆ¶ç­–ç•¥å¤±æ•ˆã€‚ä¸ºäº†è§£å†³è¯¥é—®é¢˜éœ€è¦å¼•å…¥ä¸€ç§è·¨è¿›ç¨‹ã€è·¨æœºå™¨çš„äº’æ–¥é”æœºåˆ¶æ¥æ§åˆ¶å…±äº«èµ„æºçš„è®¿é—®ï¼Œè¿™ä¹Ÿå°±æ˜¯åˆ†å¸ƒå¼é”çš„ç”±æ¥ã€‚</p> <p>æ‰€ä»¥ï¼Œåˆ†å¸ƒå¼é”çš„å¼•å…¥æ˜¯ä¸ºäº†ä¿éšœå¤šå°æœºå™¨æˆ–å¤šä¸ªè¿›ç¨‹å¯¹å…±äº«èµ„æºè¯»å†™çš„åŒæ­¥ï¼Œä¿è¯æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚</p> <p>åˆ†å¸ƒå¼é”å¤©ç”Ÿå…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p> <ul><li>äº’æ–¥æ€§ï¼šä»»ä½•æ—¶åˆ»ï¼Œåªå…è®¸å•å®¢æˆ·ç«¯ï¼ˆå•è¿›ç¨‹ã€å•èŠ‚ç‚¹ï¼‰èƒ½æŒæœ‰é”ã€‚</li> <li>å®‰å…¨æ€§ï¼šèƒ½æœ‰æ•ˆé¿å…æ­»é”æƒ…å†µï¼Œå³ä½¿å®¢æˆ·ç«¯æŒæœ‰é”æœºå™¨å‘ç”Ÿå´©æºƒæˆ–é€€å‡ºæ•…éšœï¼Œä¹Ÿéœ€è¦ä¿éšœé”èƒ½è¢«æ­£ç¡®é‡Šæ”¾ã€‚</li> <li>å¯ç”¨æ€§ï¼šå…·å¤‡é«˜å¯ç”¨èƒ½åŠ›ï¼Œé”æœåŠ¡èŠ‚ç‚¹æ•…éšœï¼ˆå³ä½¿å®•æœºï¼‰ä¹Ÿä¸åº”å½±å“æœåŠ¡çš„æ­£å¸¸è¿è¡Œã€‚</li> <li>å¯é‡å…¥æ€§ï¼šé’ˆå¯¹åŒä¸€ä¸ªé”ï¼ŒåŠ é”å’Œè§£é”å¿…é¡»ä¸ºåŒä¸€ä¸ªè¿›ç¨‹ï¼Œå³å¯¹ç§°æ€§ã€‚</li></ul> <p>å¸¸è§åˆ†å¸ƒå¼é”å®ç°æ–¹å¼ï¼š</p> <ul><li>æ•°æ®åº“ï¼šé‡‡ç”¨ä¹è§‚é”ã€æ‚²è§‚é”æˆ–ä¸»é”® ID å®ç°ã€‚</li> <li>ç¼“å­˜ï¼šé‡‡ç”¨ Redis æˆ– RedLock (Redisç»„ä»¶) å®ç°ã€‚</li> <li>ä¸€è‡´æ€§ç®—æ³•ï¼šé‡‡ç”¨ Zookeeperã€Chubby æˆ– Etcd å®ç°ã€‚</li></ul> <p>ä»¥ä¸Šï¼Œå·ä¸»çŸ¥é“çš„å¸¸è§å®ç°å¤§è‡´å°±è¿™äº›äº†ã€‚æ¥ä¸‹æ¥çš„ç¯‡å¹…ä¸»è¦è®²è§£å¦‚ä½•ä½¿ç”¨ Etcd å®ç°åˆ†å¸ƒå¼é”ä¸šåŠ¡ï¼Œæˆ‘ä»¬å¾€ä¸‹çœ‹ã€‚</p> <h2 id="åŸºäº-etcd-çš„åˆ†å¸ƒå¼é”å®ç°"><a href="#åŸºäº-etcd-çš„åˆ†å¸ƒå¼é”å®ç°" class="header-anchor">#</a> åŸºäº ETCD çš„åˆ†å¸ƒå¼é”å®ç°</h2> <h3 id="ç¯å¢ƒå®‰è£…"><a href="#ç¯å¢ƒå®‰è£…" class="header-anchor">#</a> ç¯å¢ƒå®‰è£…</h3> <p>ä¸ºäº†ä¿è¯é”æœåŠ¡<code>å¯ç”¨æ€§</code>ï¼Œæˆ‘ä»¬æ­å»ºä¸€ä¸ªåŒ…å«ä¸‰ä¸ª Etcd èŠ‚ç‚¹çš„ docker é›†ç¾¤ç¯å¢ƒï¼Œæ­¤å¤„é€šè¿‡<code>docker-compose</code>è¿›è¡Œå®éªŒé…ç½®ã€‚ç†Ÿæ‚‰éƒ¨ç½²å®‰è£…çš„å·å‹ï¼Œå¯è·³è¿‡æ­¤éƒ¨åˆ†ã€‚</p> <p><strong>æ­¥éª¤ä¸€ï¼šé•œåƒæ‹‰å–</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> pull bitnami/etcd:3.5.2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>æ­¥éª¤äºŒï¼šç¼–è¾‘docker-compose.yml</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>version: <span class="token string">'3.5'</span>

services:
  etcd1:
    container_name: builder-etcd1
    image: bitnami/etcd:3.5.2
    ports:
      - <span class="token number">12379</span>:2379
    environment:
      - <span class="token assign-left variable">ALLOW_NONE_AUTHENTICATION</span><span class="token operator">=</span>yes
      - <span class="token assign-left variable">ETCD_AUTO_COMPACTION_MODE</span><span class="token operator">=</span>revision
      - <span class="token assign-left variable">ETCD_AUTO_COMPACTION_RETENTION</span><span class="token operator">=</span><span class="token number">1002</span>
      - <span class="token assign-left variable">ETCD_QUOTA_BACKEND_BYTES</span><span class="token operator">=</span><span class="token number">4294967296</span>
      - <span class="token assign-left variable">ETCD_NAME</span><span class="token operator">=</span>etcd1
      - <span class="token assign-left variable">ETCD_INITIAL_ADVERTISE_PEER_URLS</span><span class="token operator">=</span>http://etcd1:2380
      - <span class="token assign-left variable">ETCD_LISTEN_PEER_URLS</span><span class="token operator">=</span>http://0.0.0.0:2380
      - <span class="token assign-left variable">ETCD_LISTEN_CLIENT_URLS</span><span class="token operator">=</span>http://0.0.0.0:2379
      - <span class="token assign-left variable">ETCD_ADVERTISE_CLIENT_URLS</span><span class="token operator">=</span>http://etcd1:2379
      - <span class="token assign-left variable">ETCD_INITIAL_CLUSTER_TOKEN</span><span class="token operator">=</span>etcd-cluster
      - <span class="token assign-left variable">ETCD_INITIAL_CLUSTER</span><span class="token operator">=</span>etcd1<span class="token operator">=</span>http://etcd1:2380,etcd2<span class="token operator">=</span>http://etcd2:2380,etcd3<span class="token operator">=</span>http://etcd3:2380
      - <span class="token assign-left variable">ETCD_INITIAL_CLUSTER_STATE</span><span class="token operator">=</span>new
    volumes:
      - <span class="token variable">${DOCKER_ROOT_DIR<span class="token operator">:-</span>.}</span>/volumes/etcd/data1:/bitnami/etcd

  etcd2:
    container_name: builder-etcd2
    image: bitnami/etcd:3.5.2
    ports:
      - <span class="token number">22379</span>:2379
    environment:
      - <span class="token assign-left variable">ALLOW_NONE_AUTHENTICATION</span><span class="token operator">=</span>yes
      - <span class="token assign-left variable">ETCD_AUTO_COMPACTION_MODE</span><span class="token operator">=</span>revision
      - <span class="token assign-left variable">ETCD_AUTO_COMPACTION_RETENTION</span><span class="token operator">=</span><span class="token number">1002</span>
      - <span class="token assign-left variable">ETCD_QUOTA_BACKEND_BYTES</span><span class="token operator">=</span><span class="token number">4294967296</span>
      - <span class="token assign-left variable">ETCD_NAME</span><span class="token operator">=</span>etcd2
      - <span class="token assign-left variable">ETCD_INITIAL_ADVERTISE_PEER_URLS</span><span class="token operator">=</span>http://etcd2:2380
      - <span class="token assign-left variable">ETCD_LISTEN_PEER_URLS</span><span class="token operator">=</span>http://0.0.0.0:2380
      - <span class="token assign-left variable">ETCD_LISTEN_CLIENT_URLS</span><span class="token operator">=</span>http://0.0.0.0:2379
      - <span class="token assign-left variable">ETCD_ADVERTISE_CLIENT_URLS</span><span class="token operator">=</span>http://etcd2:2379
      - <span class="token assign-left variable">ETCD_INITIAL_CLUSTER_TOKEN</span><span class="token operator">=</span>etcd-cluster
      - <span class="token assign-left variable">ETCD_INITIAL_CLUSTER</span><span class="token operator">=</span>etcd1<span class="token operator">=</span>http://etcd1:2380,etcd2<span class="token operator">=</span>http://etcd2:2380,etcd3<span class="token operator">=</span>http://etcd3:2380
      - <span class="token assign-left variable">ETCD_INITIAL_CLUSTER_STATE</span><span class="token operator">=</span>new
    volumes:
      - <span class="token variable">${DOCKER_ROOT_DIR<span class="token operator">:-</span>.}</span>/volumes/etcd/data2:/bitnami/etcd

  etcd3:
    container_name: builder-etcd3
    image: bitnami/etcd:3.5.2
    ports:
      - <span class="token number">32379</span>:2379
    environment:
      - <span class="token assign-left variable">ALLOW_NONE_AUTHENTICATION</span><span class="token operator">=</span>yes
      - <span class="token assign-left variable">ETCD_AUTO_COMPACTION_MODE</span><span class="token operator">=</span>revision
      - <span class="token assign-left variable">ETCD_AUTO_COMPACTION_RETENTION</span><span class="token operator">=</span><span class="token number">1002</span>
      - <span class="token assign-left variable">ETCD_QUOTA_BACKEND_BYTES</span><span class="token operator">=</span><span class="token number">4294967296</span>
      - <span class="token assign-left variable">ETCD_NAME</span><span class="token operator">=</span>etcd3
      - <span class="token assign-left variable">ETCD_INITIAL_ADVERTISE_PEER_URLS</span><span class="token operator">=</span>http://etcd3:2380
      - <span class="token assign-left variable">ETCD_LISTEN_PEER_URLS</span><span class="token operator">=</span>http://0.0.0.0:2380
      - <span class="token assign-left variable">ETCD_LISTEN_CLIENT_URLS</span><span class="token operator">=</span>http://0.0.0.0:2379
      - <span class="token assign-left variable">ETCD_ADVERTISE_CLIENT_URLS</span><span class="token operator">=</span>http://etcd3:2379
      - <span class="token assign-left variable">ETCD_INITIAL_CLUSTER_TOKEN</span><span class="token operator">=</span>etcd-cluster
      - <span class="token assign-left variable">ETCD_INITIAL_CLUSTER</span><span class="token operator">=</span>etcd1<span class="token operator">=</span>http://etcd1:2380,etcd2<span class="token operator">=</span>http://etcd2:2380,etcd3<span class="token operator">=</span>http://etcd3:2380
      - <span class="token assign-left variable">ETCD_INITIAL_CLUSTER_STATE</span><span class="token operator">=</span>new
    volumes:
      - <span class="token variable">${DOCKER_ROOT_DIR<span class="token operator">:-</span>.}</span>/volumes/etcd/data3:/bitnami/etcd

networks:
  default:
    name: builder_dev
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><p>éƒ¨ç½²é…ç½®æ–‡ä»¶ docker-compose.yml ä¸‹è½½ï¼Œè¯¦è§ <code>[1]</code></p> <p><strong>æ­¥éª¤ä¸‰ï¼šå¯åŠ¨æœåŠ¡</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker-compose</span> <span class="token parameter variable">-f</span> docker-compose.yml up
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>æ­¥éª¤å››ï¼šéªŒè¯é›†ç¾¤</strong></p> <p>éªŒè¯é›†ç¾¤èŠ‚ç‚¹çš„ç‰ˆæœ¬</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> builder-etcd1 /bin/bash <span class="token parameter variable">-c</span> <span class="token string">&quot;etcd --version&quot;</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> builder-etcd2 /bin/bash <span class="token parameter variable">-c</span> <span class="token string">&quot;etcd --version&quot;</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> builder-etcd3 /bin/bash <span class="token parameter variable">-c</span> <span class="token string">&quot;etcd --version&quot;</span>

<span class="token comment"># è¾“å‡º</span>
etcd Version: <span class="token number">3.5</span>.2
Git SHA: 99018a77b
Go Version: go1.16.3
Go OS/Arch: linux/amd64
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>éªŒè¯ä¸‰ä¸ªèŠ‚ç‚¹è¿”å›çš„æ•°æ®ä¸€è‡´</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> builder-etcd1 /bin/bash <span class="token parameter variable">-c</span> <span class="token string">&quot;etcdctl put greeting <span class="token entity" title="\&quot;">\&quot;</span>hello, etcd<span class="token entity" title="\&quot;">\&quot;</span>&quot;</span>
<span class="token comment"># OK</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> builder-etcd1 /bin/bash <span class="token parameter variable">-c</span> <span class="token string">&quot;etcdctl get greeting&quot;</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> builder-etcd2 /bin/bash <span class="token parameter variable">-c</span> <span class="token string">&quot;etcdctl get greeting&quot;</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> builder-etcd3 /bin/bash <span class="token parameter variable">-c</span> <span class="token string">&quot;etcdctl get greeting&quot;</span>
<span class="token comment"># è¾“å‡º</span>
greeting
hello, etcd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="é”çš„å®ç°åŸºç¡€æœºåˆ¶"><a href="#é”çš„å®ç°åŸºç¡€æœºåˆ¶" class="header-anchor">#</a> é”çš„å®ç°åŸºç¡€æœºåˆ¶</h3> <p>æ­¤å¤„ä¸º Etcd æ ¸å¿ƒæœºåˆ¶ï¼Œä¸‹æ–‡è®²è§£çš„åˆ†å¸ƒå¼é”å°±æ˜¯åŸºäºè¿™äº›åŸºç¡€åŠŸèƒ½å’ŒåŸºç¡€ç‰¹æ€§å®ç°ã€‚</p> <p><strong>Lease æœºåˆ¶</strong>ï¼šå³ç§Ÿçº¦æœºåˆ¶ï¼ˆTTLï¼‰ï¼ŒEtcd å¯ä»¥ä¸ºå­˜å‚¨çš„ kv å¯¹è®¾ç½®ç§Ÿçº¦ï¼Œå½“ç§Ÿçº¦åˆ°æœŸï¼Œkv å°†å¤±æ•ˆåˆ é™¤ï¼›å½“ç„¶ä¹Ÿæ”¯æŒ refresh ç»­çº¦ã€‚</p> <p><strong>Revision æœºåˆ¶</strong>ï¼šå­˜å‚¨çš„æ¯ä¸ª key å¸¦æœ‰ä¸€ä¸ª Revision å±æ€§å€¼ï¼ŒEtcd æ¯è¿›è¡Œä¸€æ¬¡äº‹åŠ¡æ“ä½œï¼Œå¯¹åº”çš„å…¨å±€ Revision å€¼éƒ½ä¼šåŠ ä¸€ï¼Œå› æ­¤æ¯ä¸ª key å¯¹åº”çš„ Revision å±æ€§å€¼éƒ½æ˜¯å…¨å±€å”¯ä¸€çš„ã€‚é€šè¿‡æ¯”è¾ƒ Revision çš„å¤§å°å°±èƒ½çŸ¥é“å†™æ“ä½œçš„é¡ºåºã€‚</p> <p><strong>å…¬å¹³é”æœºåˆ¶</strong>ï¼šå¤šä¸ªç¨‹åºåŒæ—¶æŠ¢é”æ—¶ï¼Œä¼šæ ¹æ® Revision å€¼å¤§å°ä¾æ¬¡è·å¾—é”ï¼Œå¯ä»¥æœ‰æ•ˆé¿å… â€œæƒŠç¾¤æ•ˆåº”â€ï¼Œå…¬å¹³è·å–ã€‚</p> <p><strong>Prefix æœºåˆ¶</strong>ï¼šå³å‰ç¼€æœºåˆ¶ï¼Œå¯ä»¥æ ¹æ®å‰ç¼€è·å–è¯¥ç›®å½•ä¸‹æ‰€æœ‰çš„ key åŠå¯¹åº”çš„å±æ€§ï¼ˆåŒ…æ‹¬ key, value ä»¥åŠ revision ç­‰ï¼‰ã€‚</p> <p><strong>Watch æœºåˆ¶</strong>ï¼šå³ç›‘å¬æœºåˆ¶ï¼ŒWatch æœºåˆ¶æ”¯æŒ Watch æŸä¸ªå›ºå®šçš„ keyï¼Œä¹Ÿæ”¯æŒ Watch ä¸€ä¸ªç›®å½•ï¼ˆå‰ç¼€æœºåˆ¶ï¼‰ï¼Œå½“è¢« Watch çš„ key æˆ–ç›®å½•å‘ç”Ÿå˜åŒ–ï¼Œå®¢æˆ·ç«¯å°†æ”¶åˆ°é€šçŸ¥ï¼ˆğŸ®ğŸ®ğŸ®ï¼‰ã€‚</p> <h3 id="é”çš„å®ç°é€»è¾‘"><a href="#é”çš„å®ç°é€»è¾‘" class="header-anchor">#</a> é”çš„å®ç°é€»è¾‘</h3> <p>åœ¨ Etcd çš„ clientv3 åŒ…ä¸­ï¼Œå®˜æ–¹å®ç°äº†åˆ†å¸ƒå¼é”ï¼Œä¸ºäº†äº†è§£å®ƒçš„å·¥ä½œæœºåˆ¶å’Œå®ç°é€»è¾‘ï¼Œæˆ‘ä»¬å…ˆåšä¸€ä¸ªç®€å•çš„<strong>æ¨¡æ‹Ÿä½¿ç”¨</strong>ã€‚</p> <p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡<code>etcdctl</code>è¿›è¡Œé”æ¨¡æ‹Ÿã€‚</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># ç»ˆç«¯ 1</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> builder-etcd1 /bin/bash <span class="token parameter variable">-c</span> <span class="token string">&quot;etcdctl lock /lock/kv/uuid_a&quot;</span>
<span class="token comment"># /lock/kv/uuid_a/12f78036a2766634</span>

<span class="token comment"># ç»ˆç«¯ 2</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> builder-etcd2 /bin/bash <span class="token parameter variable">-c</span> <span class="token string">&quot;etcdctl lock /lock/kv/uuid_a&quot;</span>
<span class="token comment"># ç»ˆç«¯ 3</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> builder-etcd3 /bin/bash <span class="token parameter variable">-c</span> <span class="token string">&quot;etcdctl lock /lock/kv/uuid_a&quot;</span>

<span class="token comment"># ç»ˆç«¯ 1 ç»“æŸï¼Œæ˜¾ç¤ºç»ˆç«¯ 2</span>
<span class="token comment"># /lock/kv/uuid_a/41ce8036a27a471d</span>
<span class="token comment"># ç»ˆç«¯ 2 ç»“æŸï¼Œæ˜¾ç¤ºç»ˆç«¯ 3</span>
<span class="token comment"># /lock/kv/uuid_a/58538036a276e81f</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>ç”±ä¸Šï¼Œä¸‰ä¸ªä¸åŒèŠ‚ç‚¹åŒæ—¶å¯¹<code>/lock/kv/uuid_a</code>è¿›è¡ŒåŠ é”ï¼Œä½†æ˜¯å´è¢«ä¾æ¬¡è·å¾—é”ï¼ˆç®€å•æ¼”ç¤ºï¼Œçœ‹çœ‹å°±è¡Œï¼ï¼‰ã€‚</p> <p>é€šè¿‡è§£ææºç ï¼Œå‘ç° Etcd åˆ†å¸ƒå¼é”çš„å®ç°ä¸»è¦é›†ä¸­åœ¨ <code>go.etcd.io/etcd/client/v3/concurrency</code> åŒ…ä¸­ï¼Œé€šè¿‡ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•è¿›è¡Œæä¾›ï¼š</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">NewMutex</span><span class="token punctuation">(</span>s <span class="token operator">*</span>Session<span class="token punctuation">,</span> pfx <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>Mutex        <span class="token comment">// æ–°å»ºä¸€ä¸ª Mutex å¯¹è±¡</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Mutex<span class="token punctuation">)</span> <span class="token function">Lock</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token builtin">error</span>     <span class="token comment">// è·å–é”ï¼Œé˜»å¡è°ƒç”¨</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Mutex<span class="token punctuation">)</span> <span class="token function">Unlock</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token builtin">error</span>   <span class="token comment">// é‡Šæ”¾é”</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ç”±ä¸Šï¼Œä½¿ç”¨ Etcd æä¾›åˆ†å¸ƒå¼é”å˜å¾—æ¯”é¢„æœŸç®€å•è®¸å¤šï¼Œé¦–å…ˆå®ä¾‹åŒ–ä¸€ä¸ª<code>Mutex</code>å¯¹è±¡ï¼Œç„¶å<code>Lock</code>å°è¯•æŠ¢å é”ï¼Œä¹‹åè¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œæœ€å<code>Unlock</code>é‡Šæ”¾é”å³å¯ã€‚</p> <p>æˆ‘ä»¬å…ˆçœ‹çœ‹<code>Lock</code>å‡½æ•°çš„å®ç°åŸç†ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// Lock locks the mutex with a cancelable context. If the context is canceled</span>
<span class="token comment">// while trying to acquire the lock, the mutex tries to clean its stale lock entry.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Mutex<span class="token punctuation">)</span> <span class="token function">Lock</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> m<span class="token punctuation">.</span><span class="token function">tryAcquire</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
	<span class="token operator">...</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Mutex<span class="token punctuation">)</span> <span class="token function">tryAcquire</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>v3<span class="token punctuation">.</span>TxnResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	s <span class="token operator">:=</span> m<span class="token punctuation">.</span>s
	client <span class="token operator">:=</span> m<span class="token punctuation">.</span>s<span class="token punctuation">.</span><span class="token function">Client</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	m<span class="token punctuation">.</span>myKey <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%s%x&quot;</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>pfx<span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">Lease</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	cmp <span class="token operator">:=</span> v3<span class="token punctuation">.</span><span class="token function">Compare</span><span class="token punctuation">(</span>v3<span class="token punctuation">.</span><span class="token function">CreateRevision</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>myKey<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;=&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token comment">// put self in lock waiters via myKey; oldest waiter holds lock</span>
	put <span class="token operator">:=</span> v3<span class="token punctuation">.</span><span class="token function">OpPut</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>myKey<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> v3<span class="token punctuation">.</span><span class="token function">WithLease</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">Lease</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">// reuse key in case this session already holds the lock</span>
	get <span class="token operator">:=</span> v3<span class="token punctuation">.</span><span class="token function">OpGet</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>myKey<span class="token punctuation">)</span>
	<span class="token comment">// fetch current holder to complete uncontended path with only one RPC</span>
	getOwner <span class="token operator">:=</span> v3<span class="token punctuation">.</span><span class="token function">OpGet</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>pfx<span class="token punctuation">,</span> v3<span class="token punctuation">.</span><span class="token function">WithFirstCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">...</span><span class="token punctuation">)</span>
	resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">Txn</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">If</span><span class="token punctuation">(</span>cmp<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Then</span><span class="token punctuation">(</span>put<span class="token punctuation">,</span> getOwner<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Else</span><span class="token punctuation">(</span>get<span class="token punctuation">,</span> getOwner<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	m<span class="token punctuation">.</span>myRev <span class="token operator">=</span> resp<span class="token punctuation">.</span>Header<span class="token punctuation">.</span>Revision
	<span class="token keyword">if</span> <span class="token operator">!</span>resp<span class="token punctuation">.</span>Succeeded <span class="token punctuation">{</span>
		m<span class="token punctuation">.</span>myRev <span class="token operator">=</span> resp<span class="token punctuation">.</span>Responses<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">GetResponseRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Kvs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>CreateRevision
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> resp<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>é¦–å…ˆé€šè¿‡ä¸€ä¸ªäº‹åŠ¡æ¥å°è¯•åŠ é”ï¼Œäº‹åŠ¡å›´ç»•ç€ç”± <code>m.pfx</code> å’Œ <code>s.Lease()</code> ç»„æˆçš„ Keyï¼ŒåŒ…å« 4 ä¸ªåŸºç¡€æ“ä½œï¼š<code>cmp</code>ã€<code>put</code>ã€<code>get</code>ã€<code>getOwner</code>ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p> <ul><li>cmpï¼šæ¯”è¾ƒ Key çš„ Revision ç‰ˆæœ¬æ˜¯å¦ä¸º 0ï¼Œå…¶ä¸­ 0 ä»£è¡¨è¯¥é”ä¸å­˜åœ¨</li> <li>putï¼šå‘ Key ä¸­å­˜å‚¨è¶…æ—¶æ—¶é—´ä¸º Session é»˜è®¤æ—¶é•¿çš„ç©ºå€¼ï¼ˆåŠ é”æ“ä½œï¼‰</li> <li>getï¼šé€šè¿‡ Key æŸ¥è¯¢å†™å…¥</li> <li>getOwnerï¼šç”±äºå…¶ä»– Session ä¹Ÿç”¨åŒæ · m.pfx åŠ é”ï¼Œä¸”æ¯ä¸ª LeaseID ä¸åŒã€‚é€šè¿‡ m.pfx å’Œ WithFirstCreate()æ¥æŸ¥è¯¢ï¼Œç¬¬ä¸€æ¬¡è‚¯å®šä¼š put æˆåŠŸï¼Œä½†ä¹Ÿåªæœ‰æœ€æ—©ä½¿ç”¨è¿™ä¸ª pfx çš„ Session æ‰æ˜¯æŒæœ‰é”çš„ï¼Œæ‰€ä»¥è¿™ä¸ª getOwner æ˜¯è¯¥äº‹åŠ¡çš„å…³é”®ã€‚</li></ul> <p>æ•´ä¸ªåˆ†å¸ƒå¼é”çš„å®ç°æ–¹å¼ï¼Œé€šè¿‡ç»Ÿä¸€çš„<code>å‰ç¼€ m.pfx</code>æ¥ putï¼Œç„¶åæ ¹æ®å„è‡ªçš„<code>Revision</code>ç‰ˆæœ¬å·æ¥æ’é˜Ÿè·å–é”ï¼Œé¿å…äº†æƒŠç¾¤æ•ˆåº”ï¼Œæ•ˆç‡éå¸¸é«˜ã€‚</p> <p><img alt="" data-src="https://files.mdnice.com/user/12678/4228508d-c89f-462b-bd35-87e208de3193.png" loading="lazy" class="lazy"></p> <p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå…±æœ‰ 4 ä¸ª Session è¿›è¡ŒåŠ é”ï¼Œæ ¹æ® Revision æ’é˜Ÿè§„åˆ™ï¼Œæœ€ç»ˆè·å–é”çš„é¡ºåºåˆ†åˆ«ä¸ºï¼š<code>Session2 -&gt; Session3 -&gt; Session1 -&gt; Session4</code>ã€‚</p> <p>å¥½äº†ï¼Œåˆ†å¸ƒå¼ç›¸å…³çŸ¥è¯†ç‚¹å°±è®²è§£å®Œäº†ï¼Œè®²çœŸ<code>Watchæœºåˆ¶</code>æ˜¯æˆ‘çš„æœ€çˆ±ï¼Œå¹³æ—¶é¡¹ç›®ä¸­ä½¿ç”¨ä¹Ÿæœ€å¤šã€‚ä½†å†æ¬¡çœ‹å®Œè¿™éƒ¨åˆ†åŸç†åï¼Œå‘ç°<code>Revisionæœºåˆ¶</code>çš„å®ç°çœŸçš„å¾ˆå·§å¦™ï¼Œä¸å¾—ä¸ä½©æœè¿™å¸®å·¨ä½¬ã€‚</p> <h3 id="python-åˆ†å¸ƒå¼é”ä½¿ç”¨"><a href="#python-åˆ†å¸ƒå¼é”ä½¿ç”¨" class="header-anchor">#</a> Python åˆ†å¸ƒå¼é”ä½¿ç”¨</h3> <p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ Etcd v3 ç‰ˆ SDK è¿›è¡Œä¸€ä¸ªç®€å•çš„ä¸šåŠ¡ä½¿ç”¨ï¼ŒæŸ¥éå…¨ç½‘ä¼¼ä¹åªæœ‰ python-etcd3 [2] è¿™ä¸ªå°ä¼—åŒ…ï¼Œå·å‹ä»¬å°†å°±ç”¨ï¼Œåˆ«åæ§½ã€‚</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: utf-8 -*-</span>

<span class="token keyword">import</span> time
<span class="token keyword">import</span> etcd3

etcd <span class="token operator">=</span> etcd3<span class="token punctuation">.</span>client<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">2379</span><span class="token punctuation">)</span>
lock_name <span class="token operator">=</span> <span class="token string">&quot;uuid_a&quot;</span>

<span class="token comment"># å®ç° A</span>
lock <span class="token operator">=</span> etcd<span class="token punctuation">.</span>lock<span class="token punctuation">(</span>lock_name<span class="token punctuation">,</span> ttl<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>lock<span class="token punctuation">.</span>is_acquired<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>       <span class="token comment"># è·å–åŠ é”çŠ¶æ€ æˆ– å…·ä½“ä¸šåŠ¡</span>
lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># å®ç° B(æ¨è)</span>
<span class="token keyword">with</span> etcd<span class="token punctuation">.</span>lock<span class="token punctuation">(</span>lock_name<span class="token punctuation">,</span> ttl<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">as</span> lock<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>lock<span class="token punctuation">.</span>is_acquired<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment"># è·å–åŠ é”çŠ¶æ€ æˆ– å…·ä½“ä¸šåŠ¡</span>
    lock<span class="token punctuation">.</span>refresh<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="header-anchor">#</a> ç»“è¯­</h2> <p>æœ¬æ–‡ä»åŸºç¡€æ¦‚å¿µã€Etcd å®ç°åŸç†ã€Python ä¸šåŠ¡åº”ç”¨è§’åº¦å¯¹åˆ†å¸ƒå¼é”è¿›è¡Œå‰–æå­¦ä¹ ï¼Œé™äºç¯‡å¹…å’Œä¸ªäººæ°´å¹³ï¼ŒGoç›¸å…³å†…å®¹æ²¡æœ‰è¿›è¡Œç»§ç»­æ·±å…¥ã€‚</p> <p>Etcd3.0 ç›¸å¯¹äº 2.0 ç‰ˆæœ¬ï¼Œå®˜æ–¹ä½¿ç”¨ gRPC æ›¿æ¢ JSONï¼Œåœ¨æ•ˆç‡ã€å¯é æ€§ã€å¯æ‰©å±•æ€§å’Œæ˜“ç”¨æ€§ç­‰æ–¹é¢éƒ½æœ‰äº†å¾ˆå¤§è¿›æ­¥ã€‚</p> <p>Python å¯¹ 3.0 ç‰ˆæœ¬æ”¯æŒè¾ƒå¼±ï¼Œä¸»è¦ä½“ç°åœ¨æ²¡æœ‰ç¨³å®šçš„ SDK åŒ…ï¼Œä¸”å¤§éƒ¨åˆ†åŒ…å¯¹ Python çš„ç‰ˆæœ¬æ”¯æŒä¹Ÿä»…é™äº &lt;= 3.7(ğŸ˜’)ã€‚</p> <h2 id="å‚è€ƒæ–‡ä»¶"><a href="#å‚è€ƒæ–‡ä»¶" class="header-anchor">#</a> å‚è€ƒæ–‡ä»¶</h2> <ul><li>[1] https://github.com/liyaodev/docker-compose</li> <li>[2] https://github.com/kragniz/python-etcd3/tree/master</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/liyaodev/lisanshiyi/edit/master/docs/md/storage/etcd/2022-04-18-guide-distributed-lock.md" target="_blank" rel="noopener noreferrer">åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°: </span> <span class="time">2023/1/4</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/md/storage/etcd/2022-06-05-guide-base.html">
          å…¥é—¨ç¯‡ï¼šetcdçš„å®‰è£…éƒ¨ç½²å’Œä½¿ç”¨å§¿åŠ¿
        </a>
        â†’
      </span></p></div> </main></div> <aside class="page-sidebar"> <div class="page-side-toolbar"><div class="option-box-toc-fixed"><div class="toc-container-sidebar"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:650px"><div style="font-weight:bold;text-align:center;">åŸºç¡€ç¯‡ï¼šetcd 3.0 å®ç°åˆ†å¸ƒå¼é”</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/md/storage/etcd/2022-04-18-guide-distributed-lock.html#ä¸Šä¸‹æ–‡" class="toc-sidebar-link">ä¸Šä¸‹æ–‡</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/md/storage/etcd/2022-04-18-guide-distributed-lock.html#åŸºäº-etcd-çš„åˆ†å¸ƒå¼é”å®ç°" class="toc-sidebar-link">åŸºäº ETCD çš„åˆ†å¸ƒå¼é”å®ç°</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/md/storage/etcd/2022-04-18-guide-distributed-lock.html#ç¯å¢ƒå®‰è£…" class="toc-sidebar-link">ç¯å¢ƒå®‰è£…</a></li><li class="toc-sidebar-sub-header"><a href="/md/storage/etcd/2022-04-18-guide-distributed-lock.html#é”çš„å®ç°åŸºç¡€æœºåˆ¶" class="toc-sidebar-link">é”çš„å®ç°åŸºç¡€æœºåˆ¶</a></li><li class="toc-sidebar-sub-header"><a href="/md/storage/etcd/2022-04-18-guide-distributed-lock.html#é”çš„å®ç°é€»è¾‘" class="toc-sidebar-link">é”çš„å®ç°é€»è¾‘</a></li><li class="toc-sidebar-sub-header"><a href="/md/storage/etcd/2022-04-18-guide-distributed-lock.html#python-åˆ†å¸ƒå¼é”ä½¿ç”¨" class="toc-sidebar-link">Python åˆ†å¸ƒå¼é”ä½¿ç”¨</a></li></ul></li><li><a href="/md/storage/etcd/2022-04-18-guide-distributed-lock.html#ç»“è¯­" class="toc-sidebar-link">ç»“è¯­</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/md/storage/etcd/2022-04-18-guide-distributed-lock.html#å‚è€ƒæ–‡ä»¶" class="toc-sidebar-link">å‚è€ƒæ–‡ä»¶</a><ul class="toc-sidebar-sub-headers"></ul></li></ul></div></div></div></div></div> <div class="option-box-toc-over"><img src="/images/system/toc.png" class="nozoom"> <span class="show-txt">ç›®å½•</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:550px"><div style="font-weight:bold;text-align:center;">åŸºç¡€ç¯‡ï¼šetcd 3.0 å®ç°åˆ†å¸ƒå¼é”</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/md/storage/etcd/2022-04-18-guide-distributed-lock.html#ä¸Šä¸‹æ–‡" class="toc-sidebar-link">ä¸Šä¸‹æ–‡</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/md/storage/etcd/2022-04-18-guide-distributed-lock.html#åŸºäº-etcd-çš„åˆ†å¸ƒå¼é”å®ç°" class="toc-sidebar-link">åŸºäº ETCD çš„åˆ†å¸ƒå¼é”å®ç°</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/md/storage/etcd/2022-04-18-guide-distributed-lock.html#ç¯å¢ƒå®‰è£…" class="toc-sidebar-link">ç¯å¢ƒå®‰è£…</a></li><li class="toc-sidebar-sub-header"><a href="/md/storage/etcd/2022-04-18-guide-distributed-lock.html#é”çš„å®ç°åŸºç¡€æœºåˆ¶" class="toc-sidebar-link">é”çš„å®ç°åŸºç¡€æœºåˆ¶</a></li><li class="toc-sidebar-sub-header"><a href="/md/storage/etcd/2022-04-18-guide-distributed-lock.html#é”çš„å®ç°é€»è¾‘" class="toc-sidebar-link">é”çš„å®ç°é€»è¾‘</a></li><li class="toc-sidebar-sub-header"><a href="/md/storage/etcd/2022-04-18-guide-distributed-lock.html#python-åˆ†å¸ƒå¼é”ä½¿ç”¨" class="toc-sidebar-link">Python åˆ†å¸ƒå¼é”ä½¿ç”¨</a></li></ul></li><li><a href="/md/storage/etcd/2022-04-18-guide-distributed-lock.html#ç»“è¯­" class="toc-sidebar-link">ç»“è¯­</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/md/storage/etcd/2022-04-18-guide-distributed-lock.html#å‚è€ƒæ–‡ä»¶" class="toc-sidebar-link">å‚è€ƒæ–‡ä»¶</a><ul class="toc-sidebar-sub-headers"></ul></li></ul></div></div></div></div></div> <div class="option-box"><img src="/images/system/wechat.png" class="nozoom"> <span class="show-txt">æ‰‹æœºçœ‹</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="text-align:center"><span style="font-size:0.9rem">å¾®ä¿¡æ‰«ä¸€æ‰«</span> <img height="180px" src="https://api.qrserver.com/v1/create-qr-code/?data=https://lisanshiyi.com/md/storage/etcd/2022-04-18-guide-distributed-lock.html" style="margin:10px;">
              æ”¯æŒ<b>æ‰‹æœºçœ‹</b>æˆ–åˆ†äº«è‡³<b>æœ‹å‹åœˆ</b></div></div></div></div> <div class="option-box"><img src="/images/system/toggle.png" width="30px" class="nozoom"> <span class="show-txt">å·¦æ </span></div> <div class="option-box"><img src="/images/system/heart-1.png" width="25px" class="nozoom"> <span class="show-txt">èµèµæˆ‘</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="text-align:center"><span style="font-size:0.8rem;font-weight:bold;">é¼“åŠ±/æ”¯æŒ/èµèµæˆ‘</span> <img height="180px" src="/images/personal/likecode.jpeg" style="margin:5px;"></div></div></div></div> <!----> <div title="å…¥é—¨ç¯‡ï¼šetcdçš„å®‰è£…éƒ¨ç½²å’Œä½¿ç”¨å§¿åŠ¿" class="option-box" style="padding-left:2px;text-align:center;"><a href="/md/storage/etcd/2022-06-05-guide-base.html"><img src="/images/system/next2.png" width="30px" class="nozoom"> <span class="show-txt">ä¸‹ä¸€ç¯‡</span></a></div></div>  <div class="page-side-sitemap"><div class="option-box"><img src="/images/system/sitemap.png" class="nozoom img"> <span class="show-txt">ç«™ç‚¹å›¾</span> <div class="sitemap-container"><h4>ç«™ç‚¹å¯¼èˆªå›¾
            <a href="/md/about/me/platform/default.html" class="sitemap-top-link"> å…³äºæˆ‘</a> <a href="/md/about/platform/default.html" class="sitemap-top-link"> å…³äºå¹³å°</a></h4> <table class="sitemap-table"><tr><td nowrap="nowrap"><div class="sitemap-col-group">å¸¸ç”¨æœç´¢</div></td> <td><div class="sitemap-col-item"><a href="http://www.baidu.com/" target="_blank" title="ç™¾åº¦">  
          ç™¾åº¦
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="http://www.google.com/" target="_blank" title="Google">  
          Google
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="http://www.bing.com/" target="_blank" title="Bing">  
          Bing
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://github.com" target="_blank" title="Github">  
          Github
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://gitee.com" target="_blank" title="Gitee">  
          Gitee
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://www.programcreek.com/java-api-examples/index.php" target="_blank" title="æœä»£ç ">  
          æœä»£ç 
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></td> <!----></tr><tr><td nowrap="nowrap"><div class="sitemap-col-group">æŠ€æœ¯ç¤¾åŒº</div></td> <td><div class="sitemap-col-item"><a href="http://www.csdn.net/" target="_blank" title="CDSN">  
          CDSN
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="http://www.cnblogs.com/" target="_blank" title="åšå®¢å›­">  
          åšå®¢å›­
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://www.oschina.net" target="_blank" title="OSChina">  
          OSChina
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://segmentfault.com/" target="_blank" title="æ€å¦">  
          æ€å¦
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://juejin.im" target="_blank" title="æ˜é‡‘">  
          æ˜é‡‘
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://www.linuxidc.com/" target="_blank" title="Linuxå…¬ç¤¾">  
          Linuxå…¬ç¤¾
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://www.ibm.com/developerworks/cn/" target="_blank" title="IBM å¼€å‘è€…">  
          IBM å¼€å‘è€…
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://stackoverflow.com" target="_blank" title="StackOverflow">  
          StackOverflow
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></td> <!----></tr><tr><td nowrap="nowrap"><div class="sitemap-col-group">çŸ¥è¯†æ˜Ÿçƒ</div></td> <td><div class="sitemap-col-item"><a href="https://t.zsxq.com/05IMnEQFY" target="_blank" title="ç¼–ç¨‹æ¸…å•">  
          ç¼–ç¨‹æ¸…å•
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></td> <!----></tr></table></div></div></div> <!----> </aside></div><div class="global-ui"><div class="read-more-wrap" style="display:none;position:absolute;bottom:0px;z-index:9999;width:100%;margin-top:-100px;font-family:PingFangSC-Regular, sans-serif;"><div id="read-more-mask" style="position: relative; height: 200px; background: -webkit-gradient(linear, 0 0%, 0 100%, from(rgba(255, 255, 255, 0)), to(rgb(255, 255, 255)));"></div> <a id="read-more-btn" target="_self" style="position: absolute; left: 50%; top: 70%; bottom: 30px; transform: translate(-50%, -50%); width: 160px; height: 36px; line-height: 36px; font-size: 15px; text-align: center; border: 1px solid rgb(222, 104, 109); color: rgb(222, 104, 109); background: rgb(255, 255, 255); cursor: pointer; border-radius: 6px;">é˜…è¯»å…¨æ–‡</a> <div id="btw-modal-wrap" style="display: none;"><div id="btw-mask" style="position: fixed; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; z-index: 999; background: rgb(0, 0, 0);"></div> <div id="btw-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 300px; text-align: center; font-size: 13px; background: rgb(255, 255, 255); border-radius: 10px; z-index: 9999; font-family: PingFangSC-Regular, sans-serif;"><span id="btw-modal-close-btn" style="position: absolute; top: 5px; right: 15px; line-height: 34px; font-size: 34px; cursor: pointer; opacity: 0.2; z-index: 9999; color: rgb(0, 0, 0); background: none; border: none; outline: none;">Ã—</span> <p id="btw-modal-header" style="margin-top: 40px; line-height: 1.8; font-size: 13px;">
                æ‰«ç æˆ–æœç´¢ï¼š<span style="color: #E9405A; font-weight: bold;">æä¸‰åä¸€</span> <br>å‘é€ï¼š<span id="site-token" class="token" style="color: #e9415a; font-weight: bold; font-size: 17px; margin-bottom: 45px;">290992</span> <br>å³å¯<span style="color: #e9415a; font-weight: bold;">ç«‹å³æ°¸ä¹…</span>è§£é”æœ¬ç«™å…¨éƒ¨æ–‡ç« </p> <img src="/images/personal/subcode.png" style="width: 180px; margin-top: 10px; margin-bottom: 30px; border: 8px solid rgb(230, 230, 230);"></div></div></div><div class="pay-read-more-wrap" style="display:none;position:absolute;bottom:0px;z-index:9999;width:100%;margin-top:-100px;font-family:PingFangSC-Regular, sans-serif;"><div id="pay-read-more-mask" style="position: relative; height: 200px; background: -webkit-gradient(linear, 0 0%, 0 100%, from(rgba(255, 255, 255, 0)), to(rgb(255, 255, 255)));"></div> <a id="pay-read-more-btn" target="_blank" style="position: absolute; left: 50%; top: 70%; bottom: 30px; transform: translate(-50%, -50%); width: 160px; height: 36px; line-height: 36px; font-size: 15px; text-align: center; border: 1px solid rgb(222, 104, 109); color: rgb(222, 104, 109); background: rgb(255, 255, 255); cursor: pointer; border-radius: 6px;">ä»˜è´¹é˜…è¯»</a></div></div></div>
    <script src="/assets/js/cg-styles.js?v=1672834611655" defer></script><script src="/assets/js/cg-3.js?v=1672834611655" defer></script><script src="/assets/js/cg-4.js?v=1672834611655" defer></script><script src="/assets/js/cg-109.js?v=1672834611655" defer></script><script src="/assets/js/cg-5.js?v=1672834611655" defer></script><script src="/assets/js/cg-6.js?v=1672834611655" defer></script><script src="/assets/js/cg-app.js?v=1672834611655" defer></script>
  </body>
</html>
